<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses, FunctionalDependencies #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ParallelListComp #-}</span><span>
</span><span id="line-3"></span><span class="hs-comment">{-|
 Maintainer: Thomas.DuBuisson@gmail.com
 Stability: beta
 Portability: portable 

This is the heart of the crypto-api package.  By making (or having) 
an instance of Hash, AsymCipher, BlockCipher or StreamCipher you provide (or obtain)
access to any infrastructure built on these primitives include block cipher modes
of operation, hashing, hmac, signing, etc.  These classes allow users to build
routines that are agnostic to the algorithm used so changing algorithms is as simple
as changing a type signature.
-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto.Classes</span><span>
</span><span id="line-17"></span><span>        </span><span class="hs-special">(</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Hash class and helper functions</span></span><span>
</span><span id="line-19"></span><span>          </span><span class="annot"><a href="Crypto.Classes.html#Hash"><span class="hs-identifier">Hash</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#hashFunc%27"><span class="hs-identifier">hashFunc'</span></a></span><span>
</span><span id="line-21"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#hashFunc"><span class="hs-identifier">hashFunc</span></a></span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Cipher classes and helper functions</span></span><span>
</span><span id="line-23"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier">BlockCipher</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier">blockSizeBytes</span></a></span><span>
</span><span id="line-25"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#keyLengthBytes"><span class="hs-identifier">keyLengthBytes</span></a></span><span>
</span><span id="line-26"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#buildKeyIO"><span class="hs-identifier">buildKeyIO</span></a></span><span>
</span><span id="line-27"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#buildKeyGen"><span class="hs-identifier">buildKeyGen</span></a></span><span>
</span><span id="line-28"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#StreamCipher"><span class="hs-identifier">StreamCipher</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#buildStreamKeyIO"><span class="hs-identifier">buildStreamKeyIO</span></a></span><span>
</span><span id="line-30"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#buildStreamKeyGen"><span class="hs-identifier">buildStreamKeyGen</span></a></span><span>
</span><span id="line-31"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#AsymCipher"><span class="hs-identifier">AsymCipher</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#buildKeyPairIO"><span class="hs-identifier">buildKeyPairIO</span></a></span><span>
</span><span id="line-33"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#buildKeyPairGen"><span class="hs-identifier">buildKeyPairGen</span></a></span><span>
</span><span id="line-34"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#Signing"><span class="hs-identifier">Signing</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#buildSigningKeyPairIO"><span class="hs-identifier">buildSigningKeyPairIO</span></a></span><span>
</span><span id="line-36"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#buildSigningKeyPairGen"><span class="hs-identifier">buildSigningKeyPairGen</span></a></span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Misc helper functions</span></span><span>
</span><span id="line-38"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">encode</span></span><span>
</span><span id="line-39"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#zeroIV"><span class="hs-identifier">zeroIV</span></a></span><span>
</span><span id="line-40"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#incIV"><span class="hs-identifier">incIV</span></a></span><span>
</span><span id="line-41"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#getIV"><span class="hs-identifier">getIV</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#getIVIO"><span class="hs-identifier">getIVIO</span></a></span><span>
</span><span id="line-42"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier">chunkFor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier">chunkFor'</span></a></span><span>
</span><span id="line-43"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Crypto.Util.html"><span class="hs-identifier">Crypto.Util</span></a></span><span>
</span><span id="line-44"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Crypto.Types.html"><span class="hs-identifier">Crypto.Types</span></a></span><span>
</span><span id="line-45"></span><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Data</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Serialize</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Serialize.Get</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SG</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Serialize.Put</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SP</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Internal</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafeUseAsCStringLen</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StateT</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runStateT</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftM</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genericDrop</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word8</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Word16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tagged</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Crypto.Types.html"><span class="hs-identifier">Crypto.Types</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Crypto.Random.html"><span class="hs-identifier">Crypto.Random</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Crypto.Util.html"><span class="hs-identifier">Crypto.Util</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ptr</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.C</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CChar</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CInt</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Entropy</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Crypto.Modes.html"><span class="hs-identifier">Crypto.Modes</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-comment">-- |The Hash class is intended as the generic interface</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- targeted by maintainers of Haskell digest implementations.</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- Using this generic interface, higher level functions</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- such as 'hash' and 'hash'' provide a useful API</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- for comsumers of hash implementations.</span><span>
</span><span id="line-78"></span><span class="hs-comment">--</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- Any instantiated implementation must handle unaligned data.</span><span>
</span><span id="line-80"></span><span class="hs-comment">--</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- Minimum complete definition: 'outputLength', 'blockLength', 'initialCtx',</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- 'updateCtx', and 'finalize'.</span><span>
</span><span id="line-83"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span id="Hash"><span class="annot"><a href="Crypto.Classes.html#Hash"><span class="hs-identifier hs-var">Hash</span></a></span></span><span> </span><span id="local-6989586621679084049"><span class="annot"><a href="#local-6989586621679084049"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621679084050"><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084049"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679084049"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>  </span><span id="outputLength"><span class="annot"><a href="Crypto.Classes.html#outputLength"><span class="hs-identifier hs-type">outputLength</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tagged</span></span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span>         </span><span class="hs-comment">-- ^ The size of the digest when encoded</span><span>
</span><span id="line-86"></span><span>  </span><span id="blockLength"><span class="annot"><a href="Crypto.Classes.html#blockLength"><span class="hs-identifier hs-type">blockLength</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tagged</span></span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span>         </span><span class="hs-comment">-- ^ The amount of data operated on in each round of the digest computation</span><span>
</span><span id="line-87"></span><span>  </span><span id="initialCtx"><span class="annot"><a href="Crypto.Classes.html#initialCtx"><span class="hs-identifier hs-type">initialCtx</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084049"><span class="hs-identifier hs-type">ctx</span></a></span><span>                        </span><span class="hs-comment">-- ^ An initial context, provided with the first call to 'updateCtx'</span><span>
</span><span id="line-88"></span><span>  </span><span id="updateCtx"><span class="annot"><a href="Crypto.Classes.html#updateCtx"><span class="hs-identifier hs-type">updateCtx</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084049"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084049"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-comment">-- ^ Used to update a context, repeatedly called until all data is exhausted</span><span>
</span><span id="line-89"></span><span>                                              </span><span class="hs-comment">--   must operate correctly for imputs of @n*blockLength@ bytes for @n `elem` [0..]@</span><span>
</span><span id="line-90"></span><span>  </span><span id="finalize"><span class="annot"><a href="Crypto.Classes.html#finalize"><span class="hs-identifier hs-type">finalize</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084049"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span>   </span><span class="hs-comment">-- ^ Finializing a context, plus any message data less than the block size, into a digest</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-comment">-- |Hash a lazy ByteString, creating a digest</span><span>
</span><span id="line-93"></span><span>  </span><span id="hash"><span class="annot"><a href="Crypto.Classes.html#hash"><span class="hs-identifier hs-type">hash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084049"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621679083805"><span class="annot"><a href="Crypto.Classes.html#hash"><span class="hs-identifier hs-var hs-var">hash</span></a></span><span> </span><span id="local-6989586621679083804"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083804"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679083803"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-96"></span><span>    </span><span id="local-6989586621679083803"><span class="annot"><span class="annottext">res :: d
</span><a href="#local-6989586621679083803"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx -&gt; ByteString -&gt; d
forall ctx d. Hash ctx d =&gt; ctx -&gt; ByteString -&gt; d
</span><a href="Crypto.Classes.html#finalize"><span class="hs-identifier hs-var">finalize</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621679083802"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083801"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621679083802"><span class="annot"><span class="annottext">ctx :: ctx
</span><a href="#local-6989586621679083802"><span class="hs-identifier hs-var hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ctx -&gt; ByteString -&gt; ctx) -&gt; ctx -&gt; [ByteString] -&gt; ctx
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">ctx -&gt; ByteString -&gt; ctx
forall ctx d. Hash ctx d =&gt; ctx -&gt; ByteString -&gt; ctx
</span><a href="Crypto.Classes.html#updateCtx"><span class="hs-identifier hs-var">updateCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
forall ctx d. Hash ctx d =&gt; ctx
</span><a href="Crypto.Classes.html#initialCtx"><span class="hs-identifier hs-var">initialCtx</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083800"><span class="hs-identifier hs-var">blks</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679083800"><span class="annot"><span class="annottext">blks :: [ByteString]
</span><a href="#local-6989586621679083800"><span class="hs-identifier hs-var">blks</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083801"><span class="annot"><span class="annottext">end :: ByteString
</span><a href="#local-6989586621679083801"><span class="hs-identifier hs-var">end</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength -&gt; ([ByteString], ByteString)
</span><a href="Crypto.Classes.html#makeBlocks"><span class="hs-identifier hs-var">makeBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083804"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083798"><span class="hs-identifier hs-var">blockLen</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621679083798"><span class="annot"><span class="annottext">blockLen :: ByteLength
</span><a href="#local-6989586621679083798"><span class="hs-identifier hs-var hs-var">blockLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tagged d ByteLength
forall ctx d. Hash ctx d =&gt; Tagged d ByteLength
</span><a href="Crypto.Classes.html#blockLength"><span class="hs-identifier hs-var">blockLength</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged d ByteLength -&gt; d -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#.%3A%3A."><span class="hs-operator hs-var">.::.</span></a></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679083803"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-comment">-- |Hash a strict ByteString, creating a digest</span></span><span>
</span><span id="line-102"></span><span>  </span><span id="hash%27"><span class="annot"><a href="Crypto.Classes.html#hash%27"><span class="hs-identifier hs-type">hash'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084049"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084050"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621679083794"><span class="annot"><a href="Crypto.Classes.html#hash%27"><span class="hs-identifier hs-var hs-var">hash'</span></a></span><span> </span><span id="local-6989586621679083793"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083793"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679083792"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621679083792"><span class="annot"><span class="annottext">res :: d
</span><a href="#local-6989586621679083792"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx -&gt; ByteString -&gt; d
forall ctx d. Hash ctx d =&gt; ctx -&gt; ByteString -&gt; d
</span><a href="Crypto.Classes.html#finalize"><span class="hs-identifier hs-var">finalize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx -&gt; ByteString -&gt; ctx
forall ctx d. Hash ctx d =&gt; ctx -&gt; ByteString -&gt; ctx
</span><a href="Crypto.Classes.html#updateCtx"><span class="hs-identifier hs-var">updateCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
forall ctx d. Hash ctx d =&gt; ctx
</span><a href="Crypto.Classes.html#initialCtx"><span class="hs-identifier hs-var">initialCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083791"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083790"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679083791"><span class="annot"><span class="annottext">top :: ByteString
</span><a href="#local-6989586621679083791"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083790"><span class="annot"><span class="annottext">end :: ByteString
</span><a href="#local-6989586621679083790"><span class="hs-identifier hs-var">end</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">B.splitAt</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083788"><span class="hs-identifier hs-var">remlen</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083793"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621679083788"><span class="annot"><span class="annottext">remlen :: ByteLength
</span><a href="#local-6989586621679083788"><span class="hs-identifier hs-var hs-var">remlen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083793"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083793"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`rem`</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083785"><span class="hs-identifier hs-var">bLen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621679083785"><span class="annot"><span class="annottext">bLen :: ByteLength
</span><a href="#local-6989586621679083785"><span class="hs-identifier hs-var hs-var">bLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tagged d ByteLength
forall ctx d. Hash ctx d =&gt; Tagged d ByteLength
</span><a href="Crypto.Classes.html#blockLength"><span class="hs-identifier hs-var">blockLength</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged d ByteLength -&gt; d -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#for"><span class="hs-operator hs-var">`for`</span></a></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679083792"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- |Obtain a lazy hash function whose result is the same type</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- as the given digest, which is discarded.  If the type is already inferred then</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- consider using the 'hash' function instead.</span><span>
</span><span id="line-113"></span><span id="local-6989586621679083782"><span id="local-6989586621679083783"><span class="annot"><a href="Crypto.Classes.html#hashFunc"><span class="hs-identifier hs-type">hashFunc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083783"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083782"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083782"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083782"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-114"></span><span id="hashFunc"><span class="annot"><span class="annottext">hashFunc :: d -&gt; ByteString -&gt; d
</span><a href="Crypto.Classes.html#hashFunc"><span class="hs-identifier hs-var hs-var">hashFunc</span></a></span></span><span> </span><span id="local-6989586621679083781"><span class="annot"><span class="annottext">d :: d
</span><a href="#local-6989586621679083781"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; d
</span><a href="#local-6989586621679083780"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-116"></span><span>  </span><span id="local-6989586621679083780"><span class="annot"><span class="annottext">f :: ByteString -&gt; d
</span><a href="#local-6989586621679083780"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; d
forall ctx d. (Hash ctx d, Hash ctx d) =&gt; ByteString -&gt; d
</span><a href="Crypto.Classes.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span id="local-6989586621679083779"><span class="annot"><span class="annottext">a :: d
</span><a href="#local-6989586621679083779"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; d
</span><a href="#local-6989586621679083780"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="annot"><span class="annottext">d -&gt; d -&gt; d
forall a. a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`asTypeOf`</span></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679083781"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- |Obtain a strict hash function whose result is the same type</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- as the given digest, which is discarded.  If the type is already inferred then</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- consider using the 'hash'' function instead.</span><span>
</span><span id="line-122"></span><span id="local-6989586621679083775"><span id="local-6989586621679083776"><span class="annot"><a href="Crypto.Classes.html#hashFunc%27"><span class="hs-identifier hs-type">hashFunc'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083776"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083775"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083775"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083775"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-123"></span><span id="hashFunc%27"><span class="annot"><span class="annottext">hashFunc' :: d -&gt; ByteString -&gt; d
</span><a href="Crypto.Classes.html#hashFunc%27"><span class="hs-identifier hs-var hs-var">hashFunc'</span></a></span></span><span> </span><span id="local-6989586621679083774"><span class="annot"><span class="annottext">d :: d
</span><a href="#local-6989586621679083774"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; d
</span><a href="#local-6989586621679083773"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621679083773"><span class="annot"><span class="annottext">f :: ByteString -&gt; d
</span><a href="#local-6989586621679083773"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; d
forall ctx d. (Hash ctx d, Hash ctx d) =&gt; ByteString -&gt; d
</span><a href="Crypto.Classes.html#hash%27"><span class="hs-identifier hs-var">hash'</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span id="local-6989586621679083772"><span class="annot"><span class="annottext">a :: d
</span><a href="#local-6989586621679083772"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; d
</span><a href="#local-6989586621679083773"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="annot"><span class="annottext">d -&gt; d -&gt; d
forall a. a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`asTypeOf`</span></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679083774"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#makeBlocks"><span class="hs-pragma hs-type">makeBlocks</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-129"></span><span class="annot"><a href="Crypto.Classes.html#makeBlocks"><span class="hs-identifier hs-type">makeBlocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#ByteLength"><span class="hs-identifier hs-type">ByteLength</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span id="makeBlocks"><span class="annot"><span class="annottext">makeBlocks :: ByteString -&gt; ByteLength -&gt; ([ByteString], ByteString)
</span><a href="Crypto.Classes.html#makeBlocks"><span class="hs-identifier hs-var hs-var">makeBlocks</span></a></span></span><span> </span><span id="local-6989586621679083771"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083771"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679083770"><span class="annot"><span class="annottext">len :: ByteLength
</span><a href="#local-6989586621679083770"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083769"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">L.toChunks</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083771"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-132"></span><span>  </span><span id="local-6989586621679083769"><span class="annot"><span class="annottext">go :: [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083769"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">B.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="#local-6989586621679083769"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083766"><span class="annot"><span class="annottext">x :: ByteString
</span><a href="#local-6989586621679083766"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083765"><span class="annot"><span class="annottext">xs :: [ByteString]
</span><a href="#local-6989586621679083765"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083766"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083770"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083764"><span class="annot"><span class="annottext">l :: ByteLength
</span><a href="#local-6989586621679083764"><span class="hs-identifier hs-var hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083766"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083766"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`rem`</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083770"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-136"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083763"><span class="annot"><span class="annottext">top :: ByteString
</span><a href="#local-6989586621679083763"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083762"><span class="annot"><span class="annottext">end :: ByteString
</span><a href="#local-6989586621679083762"><span class="hs-identifier hs-var">end</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">B.splitAt</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083764"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083766"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-137"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083761"><span class="annot"><span class="annottext">rest :: [ByteString]
</span><a href="#local-6989586621679083761"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083760"><span class="annot"><span class="annottext">trueEnd :: ByteString
</span><a href="#local-6989586621679083760"><span class="hs-identifier hs-var">trueEnd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083769"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083762"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083765"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083763"><span class="hs-identifier hs-var">top</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083761"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083760"><span class="hs-identifier hs-var">trueEnd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083765"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-141"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083766"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679083759"><span class="annot"><span class="annottext">a :: ByteString
</span><a href="#local-6989586621679083759"><span class="hs-identifier hs-var">a</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083758"><span class="annot"><span class="annottext">as :: [ByteString]
</span><a href="#local-6989586621679083758"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083769"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B.append</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083766"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083759"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083758"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">-- |The BlockCipher class is intended as the generic interface</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- targeted by maintainers of Haskell cipher implementations.</span><span>
</span><span id="line-146"></span><span class="hs-comment">--</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- Minimum complete definition: blockSize, encryptBlock, decryptBlock,</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- buildKey, and keyLength.</span><span>
</span><span id="line-149"></span><span class="hs-comment">--</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- Instances must handle unaligned data</span><span>
</span><span id="line-151"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="BlockCipher"><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-var">BlockCipher</span></a></span></span><span> </span><span id="local-6989586621679084029"><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-152"></span><span>  </span><span id="blockSize"><span class="annot"><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-type">blockSize</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tagged</span></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span>                   </span><span class="hs-comment">-- ^ The size of a single block; the smallest unit on which the cipher operates.</span><span>
</span><span id="line-153"></span><span>  </span><span id="encryptBlock"><span class="annot"><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-type">encryptBlock</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>    </span><span class="hs-comment">-- ^ encrypt data of size @n*blockSize@ where @n `elem` [0..]@  (ecb encryption)</span><span>
</span><span id="line-154"></span><span>  </span><span id="decryptBlock"><span class="annot"><a href="Crypto.Classes.html#decryptBlock"><span class="hs-identifier hs-type">decryptBlock</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>    </span><span class="hs-comment">-- ^ decrypt data of size @n*blockSize@ where @n `elem` [0..]@  (ecb decryption)</span><span>
</span><span id="line-155"></span><span>  </span><span id="buildKey"><span class="annot"><a href="Crypto.Classes.html#buildKey"><span class="hs-identifier hs-type">buildKey</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span>              </span><span class="hs-comment">-- ^ smart constructor for keys from a bytestring.</span><span>
</span><span id="line-156"></span><span>  </span><span id="keyLength"><span class="annot"><a href="Crypto.Classes.html#keyLength"><span class="hs-identifier hs-type">keyLength</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tagged</span></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span>                   </span><span class="hs-comment">-- ^ length of the cryptographic key</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-comment">-- * Modes of operation over strict bytestrings</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-comment">-- | Electronic Cookbook (encryption)</span><span>
</span><span id="line-160"></span><span>  </span><span id="ecb"><span class="annot"><a href="Crypto.Classes.html#ecb"><span class="hs-identifier hs-type">ecb</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621679083750"><span class="annot"><a href="Crypto.Classes.html#ecb"><span class="hs-identifier hs-var hs-var">ecb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#modeEcb%27"><span class="hs-identifier hs-var">modeEcb'</span></a></span></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-comment">-- | Electronic Cookbook (decryption)</span><span>
</span><span id="line-163"></span><span>  </span><span id="unEcb"><span class="annot"><a href="Crypto.Classes.html#unEcb"><span class="hs-identifier hs-type">unEcb</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-164"></span><span>  </span><span id="local-6989586621679083747"><span class="annot"><a href="Crypto.Classes.html#unEcb"><span class="hs-identifier hs-var hs-var">unEcb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#modeUnEcb%27"><span class="hs-identifier hs-var">modeUnEcb'</span></a></span></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-comment">-- | Cipherblock Chaining (encryption)</span><span>
</span><span id="line-166"></span><span>  </span><span id="cbc"><span class="annot"><a href="Crypto.Classes.html#cbc"><span class="hs-identifier hs-type">cbc</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621679083744"><span class="annot"><a href="Crypto.Classes.html#cbc"><span class="hs-identifier hs-var hs-var">cbc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCbc%27"><span class="hs-identifier hs-var">modeCbc'</span></a></span></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-comment">-- | Cipherblock Chaining (decryption)</span><span>
</span><span id="line-169"></span><span>  </span><span id="unCbc"><span class="annot"><a href="Crypto.Classes.html#unCbc"><span class="hs-identifier hs-type">unCbc</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>  </span><span id="local-6989586621679083741"><span class="annot"><a href="Crypto.Classes.html#unCbc"><span class="hs-identifier hs-var hs-var">unCbc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCbc%27"><span class="hs-identifier hs-var">modeUnCbc'</span></a></span></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-comment">-- | Counter (encryption)</span><span>
</span><span id="line-173"></span><span>  </span><span id="ctr"><span class="annot"><a href="Crypto.Classes.html#ctr"><span class="hs-identifier hs-type">ctr</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>  </span><span id="local-6989586621679083738"><span class="annot"><a href="Crypto.Classes.html#ctr"><span class="hs-identifier hs-var hs-var">ctr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCtr%27"><span class="hs-identifier hs-var">modeCtr'</span></a></span><span> </span><span class="annot"><span class="annottext">IV k -&gt; IV k
forall k. BlockCipher k =&gt; IV k -&gt; IV k
</span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var">incIV</span></a></span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-comment">-- | Counter (decryption)</span><span>
</span><span id="line-177"></span><span>  </span><span id="unCtr"><span class="annot"><a href="Crypto.Classes.html#unCtr"><span class="hs-identifier hs-type">unCtr</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621679083735"><span class="annot"><a href="Crypto.Classes.html#unCtr"><span class="hs-identifier hs-var hs-var">unCtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCtr%27"><span class="hs-identifier hs-var">modeUnCtr'</span></a></span><span> </span><span class="annot"><span class="annottext">IV k -&gt; IV k
forall k. BlockCipher k =&gt; IV k -&gt; IV k
</span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var">incIV</span></a></span></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-comment">-- | Counter (encryption)</span><span>
</span><span id="line-181"></span><span>  </span><span id="ctrLazy"><span class="annot"><a href="Crypto.Classes.html#ctrLazy"><span class="hs-identifier hs-type">ctrLazy</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>  </span><span id="local-6989586621679083732"><span class="annot"><a href="Crypto.Classes.html#ctrLazy"><span class="hs-identifier hs-var hs-var">ctrLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCtr"><span class="hs-identifier hs-var">modeCtr</span></a></span><span> </span><span class="annot"><span class="annottext">IV k -&gt; IV k
forall k. BlockCipher k =&gt; IV k -&gt; IV k
</span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var">incIV</span></a></span></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-comment">-- | Counter (decryption)</span><span>
</span><span id="line-185"></span><span>  </span><span id="unCtrLazy"><span class="annot"><a href="Crypto.Classes.html#unCtrLazy"><span class="hs-identifier hs-type">unCtrLazy</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>  </span><span id="local-6989586621679083729"><span class="annot"><a href="Crypto.Classes.html#unCtrLazy"><span class="hs-identifier hs-var hs-var">unCtrLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCtr"><span class="hs-identifier hs-var">modeUnCtr</span></a></span><span> </span><span class="annot"><span class="annottext">IV k -&gt; IV k
forall k. BlockCipher k =&gt; IV k -&gt; IV k
</span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var">incIV</span></a></span></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-comment">-- | Ciphertext feedback (encryption)</span><span>
</span><span id="line-189"></span><span>  </span><span id="cfb"><span class="annot"><a href="Crypto.Classes.html#cfb"><span class="hs-identifier hs-type">cfb</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621679083726"><span class="annot"><a href="Crypto.Classes.html#cfb"><span class="hs-identifier hs-var hs-var">cfb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCfb%27"><span class="hs-identifier hs-var">modeCfb'</span></a></span></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-comment">-- | Ciphertext feedback (decryption)</span><span>
</span><span id="line-192"></span><span>  </span><span id="unCfb"><span class="annot"><a href="Crypto.Classes.html#unCfb"><span class="hs-identifier hs-type">unCfb</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621679083723"><span class="annot"><a href="Crypto.Classes.html#unCfb"><span class="hs-identifier hs-var hs-var">unCfb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCfb%27"><span class="hs-identifier hs-var">modeUnCfb'</span></a></span></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-comment">-- | Output feedback (encryption)</span><span>
</span><span id="line-195"></span><span>  </span><span id="ofb"><span class="annot"><a href="Crypto.Classes.html#ofb"><span class="hs-identifier hs-type">ofb</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621679083720"><span class="annot"><a href="Crypto.Classes.html#ofb"><span class="hs-identifier hs-var hs-var">ofb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeOfb%27"><span class="hs-identifier hs-var">modeOfb'</span></a></span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-comment">-- | Output feedback (decryption)</span><span>
</span><span id="line-199"></span><span>  </span><span id="unOfb"><span class="annot"><a href="Crypto.Classes.html#unOfb"><span class="hs-identifier hs-type">unOfb</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>  </span><span id="local-6989586621679083717"><span class="annot"><a href="Crypto.Classes.html#unOfb"><span class="hs-identifier hs-var hs-var">unOfb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnOfb%27"><span class="hs-identifier hs-var">modeUnOfb'</span></a></span></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-comment">-- |Cipher block chaining encryption for lazy bytestrings</span><span>
</span><span id="line-203"></span><span>  </span><span id="cbcLazy"><span class="annot"><a href="Crypto.Classes.html#cbcLazy"><span class="hs-identifier hs-type">cbcLazy</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>  </span><span id="local-6989586621679083714"><span class="annot"><a href="Crypto.Classes.html#cbcLazy"><span class="hs-identifier hs-var hs-var">cbcLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCbc"><span class="hs-identifier hs-var">modeCbc</span></a></span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-comment">-- |Cipher block chaining decryption for lazy bytestrings</span><span>
</span><span id="line-207"></span><span>  </span><span id="unCbcLazy"><span class="annot"><a href="Crypto.Classes.html#unCbcLazy"><span class="hs-identifier hs-type">unCbcLazy</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>  </span><span id="local-6989586621679083711"><span class="annot"><a href="Crypto.Classes.html#unCbcLazy"><span class="hs-identifier hs-var hs-var">unCbcLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCbc"><span class="hs-identifier hs-var">modeUnCbc</span></a></span></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-comment">-- |SIV (Synthetic IV) mode for lazy bytestrings. The third argument is</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-comment">-- the optional list of bytestrings to be authenticated but not</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-comment">-- encrypted As required by the specification this algorithm may</span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-comment">-- return nothing when certain constraints aren't met.</span><span>
</span><span id="line-214"></span><span>  </span><span id="sivLazy"><span class="annot"><a href="Crypto.Classes.html#sivLazy"><span class="hs-identifier hs-type">sivLazy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span>
</span><span id="line-215"></span><span>  </span><span id="local-6989586621679083708"><span class="annot"><a href="Crypto.Classes.html#sivLazy"><span class="hs-identifier hs-var hs-var">sivLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
forall k.
BlockCipher k =&gt;
k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Crypto.Classes.html#modeSiv"><span class="hs-identifier hs-var">modeSiv</span></a></span></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-comment">-- |SIV (Synthetic IV) for lazy bytestrings.  The third argument is the</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-comment">-- optional list of bytestrings to be authenticated but not encrypted.</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-comment">-- As required by the specification this algorithm may return nothing</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-comment">-- when authentication fails.</span><span>
</span><span id="line-221"></span><span>  </span><span id="unSivLazy"><span class="annot"><a href="Crypto.Classes.html#unSivLazy"><span class="hs-identifier hs-type">unSivLazy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span>
</span><span id="line-222"></span><span>  </span><span id="local-6989586621679083705"><span class="annot"><a href="Crypto.Classes.html#unSivLazy"><span class="hs-identifier hs-var hs-var">unSivLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
forall k.
BlockCipher k =&gt;
k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Crypto.Classes.html#modeUnSiv"><span class="hs-identifier hs-var">modeUnSiv</span></a></span></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-comment">-- |SIV (Synthetic IV) mode for strict bytestrings.  First argument is</span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-comment">-- the optional list of bytestrings to be authenticated but not</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-comment">-- encrypted.  As required by the specification this algorithm may</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-comment">-- return nothing when certain constraints aren't met.</span><span>
</span><span id="line-228"></span><span>  </span><span id="siv"><span class="annot"><a href="Crypto.Classes.html#siv"><span class="hs-identifier hs-type">siv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621679083702"><span class="annot"><a href="Crypto.Classes.html#siv"><span class="hs-identifier hs-var hs-var">siv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
forall k.
BlockCipher k =&gt;
k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Crypto.Classes.html#modeSiv%27"><span class="hs-identifier hs-var">modeSiv'</span></a></span></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-comment">-- |SIV (Synthetic IV) for strict bytestrings First argument is the</span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-comment">-- optional list of bytestrings to be authenticated but not encrypted</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-comment">-- As required by the specification this algorithm may return nothing</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-comment">-- when authentication fails.</span><span>
</span><span id="line-235"></span><span>  </span><span id="unSiv"><span class="annot"><a href="Crypto.Classes.html#unSiv"><span class="hs-identifier hs-type">unSiv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-236"></span><span>  </span><span id="local-6989586621679083699"><span class="annot"><a href="Crypto.Classes.html#unSiv"><span class="hs-identifier hs-var hs-var">unSiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
forall k.
BlockCipher k =&gt;
k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Crypto.Classes.html#modeUnSiv%27"><span class="hs-identifier hs-var">modeUnSiv'</span></a></span></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-comment">-- |Cook book mode - not really a mode at all.  If you don't know what you're doing, don't use this mode^H^H^H^H library.</span><span>
</span><span id="line-239"></span><span>  </span><span id="ecbLazy"><span class="annot"><a href="Crypto.Classes.html#ecbLazy"><span class="hs-identifier hs-type">ecbLazy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621679083696"><span class="annot"><a href="Crypto.Classes.html#ecbLazy"><span class="hs-identifier hs-var hs-var">ecbLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#modeEcb"><span class="hs-identifier hs-var">modeEcb</span></a></span></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-comment">-- |ECB decrypt, complementary to `ecb`.</span><span>
</span><span id="line-243"></span><span>  </span><span id="unEcbLazy"><span class="annot"><a href="Crypto.Classes.html#unEcbLazy"><span class="hs-identifier hs-type">unEcbLazy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span>
</span><span id="line-244"></span><span>  </span><span id="local-6989586621679083693"><span class="annot"><a href="Crypto.Classes.html#unEcbLazy"><span class="hs-identifier hs-var hs-var">unEcbLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#modeUnEcb"><span class="hs-identifier hs-var">modeUnEcb</span></a></span></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-comment">-- |Ciphertext feed-back encryption mode for lazy bytestrings (with s</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-comment">-- == blockSize)</span><span>
</span><span id="line-248"></span><span>  </span><span id="cfbLazy"><span class="annot"><a href="Crypto.Classes.html#cfbLazy"><span class="hs-identifier hs-type">cfbLazy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621679083690"><span class="annot"><a href="Crypto.Classes.html#cfbLazy"><span class="hs-identifier hs-var hs-var">cfbLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCfb"><span class="hs-identifier hs-var">modeCfb</span></a></span></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-comment">-- |Ciphertext feed-back decryption mode for lazy bytestrings (with s</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-comment">-- == blockSize)</span><span>
</span><span id="line-253"></span><span>  </span><span id="unCfbLazy"><span class="annot"><a href="Crypto.Classes.html#unCfbLazy"><span class="hs-identifier hs-type">unCfbLazy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>  </span><span id="local-6989586621679083687"><span class="annot"><a href="Crypto.Classes.html#unCfbLazy"><span class="hs-identifier hs-var hs-var">unCfbLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCfb"><span class="hs-identifier hs-var">modeUnCfb</span></a></span></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-comment">-- |Output feedback mode for lazy bytestrings</span><span>
</span><span id="line-257"></span><span>  </span><span id="ofbLazy"><span class="annot"><a href="Crypto.Classes.html#ofbLazy"><span class="hs-identifier hs-type">ofbLazy</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621679083684"><span class="annot"><a href="Crypto.Classes.html#ofbLazy"><span class="hs-identifier hs-var hs-var">ofbLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeOfb"><span class="hs-identifier hs-var">modeOfb</span></a></span></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-comment">-- |Output feedback mode for lazy bytestrings</span><span>
</span><span id="line-261"></span><span>  </span><span id="unOfbLazy"><span class="annot"><a href="Crypto.Classes.html#unOfbLazy"><span class="hs-identifier hs-type">unOfbLazy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084029"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>  </span><span id="local-6989586621679083681"><span class="annot"><a href="Crypto.Classes.html#unOfbLazy"><span class="hs-identifier hs-var hs-var">unOfbLazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnOfb"><span class="hs-identifier hs-var">modeUnOfb</span></a></span></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- |Output feedback mode for lazy bytestrings</span><span>
</span><span id="line-265"></span><span id="local-6989586621679083679"><span class="annot"><a href="Crypto.Classes.html#modeOfb"><span class="hs-identifier hs-type">modeOfb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083679"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083679"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083679"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083679"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-266"></span><span id="modeOfb"><span class="annot"><span class="annottext">modeOfb :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeOfb"><span class="hs-identifier hs-var hs-var">modeOfb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnOfb"><span class="hs-identifier hs-var">modeUnOfb</span></a></span><span>
</span><span id="line-267"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeOfb"><span class="hs-pragma hs-type">modeOfb</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- |Output feedback mode for lazy bytestrings</span><span>
</span><span id="line-270"></span><span id="local-6989586621679083678"><span class="annot"><a href="Crypto.Classes.html#modeUnOfb"><span class="hs-identifier hs-type">modeUnOfb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083678"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083678"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083678"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083678"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-271"></span><span id="modeUnOfb"><span class="annot"><span class="annottext">modeUnOfb :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnOfb"><span class="hs-identifier hs-var hs-var">modeUnOfb</span></a></span></span><span> </span><span id="local-6989586621679083677"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083677"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083675"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083675"><span class="hs-identifier hs-var">iv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083674"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083674"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083673"><span class="annot"><span class="annottext">ivStr :: [ByteString]
</span><a href="#local-6989586621679083673"><span class="hs-identifier hs-var hs-var">ivStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; [ByteString] -&gt; [ByteString]
forall a. ByteLength -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; [ByteString]
forall a. (a -&gt; a) -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">iterate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083677"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083675"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>            </span><span id="local-6989586621679083670"><span class="annot"><span class="annottext">ivLen :: Int64
</span><a href="#local-6989586621679083670"><span class="hs-identifier hs-var hs-var">ivLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083675"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>            </span><span id="local-6989586621679083669"><span class="annot"><span class="annottext">newIV :: IV k
</span><a href="#local-6989586621679083669"><span class="hs-identifier hs-var hs-var">newIV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k)
-&gt; ([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; IV k
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString)
-&gt; ([ByteString] -&gt; [ByteString]) -&gt; [ByteString] -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">L.toChunks</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; [ByteString])
-&gt; ([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; [ByteString]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">L.take</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679083670"><span class="hs-identifier hs-var">ivLen</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; ([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">L.drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><span class="hs-identifier hs-var">L.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083674"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; ([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">L.fromChunks</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; IV k) -&gt; [ByteString] -&gt; IV k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083673"><span class="hs-identifier hs-var">ivStr</span></a></span><span>
</span><span id="line-275"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Util.html#zwp"><span class="hs-identifier hs-var">zwp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">L.fromChunks</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083673"><span class="hs-identifier hs-var">ivStr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083674"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IV k
forall k. IV k
</span><a href="#local-6989586621679083669"><span class="hs-identifier hs-var">newIV</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeUnOfb"><span class="hs-pragma hs-type">modeUnOfb</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- |Ciphertext feed-back encryption mode for lazy bytestrings (with s</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- == blockSize)</span><span>
</span><span id="line-281"></span><span id="local-6989586621679083661"><span class="annot"><a href="Crypto.Classes.html#modeCfb"><span class="hs-identifier hs-type">modeCfb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083661"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083661"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083661"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083661"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-282"></span><span id="modeCfb"><span class="annot"><span class="annottext">modeCfb :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCfb"><span class="hs-identifier hs-var hs-var">modeCfb</span></a></span></span><span> </span><span id="local-6989586621679083660"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083660"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083659"><span class="annot"><span class="annottext">v :: ByteString
</span><a href="#local-6989586621679083659"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083658"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083658"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-283"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083657"><span class="annot"><span class="annottext">blks :: [ByteString]
</span><a href="#local-6989586621679083657"><span class="hs-identifier hs-var hs-var">blks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083660"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083658"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-284"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083656"><span class="annot"><span class="annottext">cs :: [ByteString]
</span><a href="#local-6989586621679083656"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083655"><span class="annot"><span class="annottext">ivF :: ByteString
</span><a href="#local-6989586621679083655"><span class="hs-identifier hs-var">ivF</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083654"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083659"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083657"><span class="hs-identifier hs-var">blks</span></a></span><span>
</span><span id="line-285"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">L.fromChunks</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083656"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083655"><span class="hs-identifier hs-var">ivF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-287"></span><span>  </span><span id="local-6989586621679083654"><span class="annot"><span class="annottext">go :: ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083654"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679083653"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083653"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083653"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><a href="#local-6989586621679083654"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679083652"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083652"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083651"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621679083651"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083650"><span class="annot"><span class="annottext">bs :: [ByteString]
</span><a href="#local-6989586621679083650"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083649"><span class="annot"><span class="annottext">c :: ByteString
</span><a href="#local-6989586621679083649"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083660"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083652"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083651"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-290"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083647"><span class="annot"><span class="annottext">cs :: [ByteString]
</span><a href="#local-6989586621679083647"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083646"><span class="annot"><span class="annottext">ivFinal :: ByteString
</span><a href="#local-6989586621679083646"><span class="hs-identifier hs-var">ivFinal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083654"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083649"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083650"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083649"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083647"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083646"><span class="hs-identifier hs-var">ivFinal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeCfb"><span class="hs-pragma hs-type">modeCfb</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span class="hs-comment">-- |Ciphertext feed-back decryption mode for lazy bytestrings (with s</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- == blockSize)</span><span>
</span><span id="line-296"></span><span id="local-6989586621679083645"><span class="annot"><a href="Crypto.Classes.html#modeUnCfb"><span class="hs-identifier hs-type">modeUnCfb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083645"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083645"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083645"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083645"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-297"></span><span id="modeUnCfb"><span class="annot"><span class="annottext">modeUnCfb :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCfb"><span class="hs-identifier hs-var hs-var">modeUnCfb</span></a></span></span><span> </span><span id="local-6989586621679083644"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083644"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083643"><span class="annot"><span class="annottext">v :: ByteString
</span><a href="#local-6989586621679083643"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083642"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083642"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-298"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083641"><span class="annot"><span class="annottext">blks :: [ByteString]
</span><a href="#local-6989586621679083641"><span class="hs-identifier hs-var hs-var">blks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083644"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083642"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-299"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083640"><span class="annot"><span class="annottext">ps :: [ByteString]
</span><a href="#local-6989586621679083640"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083639"><span class="annot"><span class="annottext">ivF :: ByteString
</span><a href="#local-6989586621679083639"><span class="hs-identifier hs-var">ivF</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083638"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083643"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083641"><span class="hs-identifier hs-var">blks</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">L.fromChunks</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083640"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083639"><span class="hs-identifier hs-var">ivF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621679083638"><span class="annot"><span class="annottext">go :: ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083638"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679083637"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083637"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083637"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><a href="#local-6989586621679083638"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679083636"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083636"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083635"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621679083635"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083634"><span class="annot"><span class="annottext">bs :: [ByteString]
</span><a href="#local-6989586621679083634"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-304"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083633"><span class="annot"><span class="annottext">p :: ByteString
</span><a href="#local-6989586621679083633"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083644"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083636"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083635"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-305"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083632"><span class="annot"><span class="annottext">ps :: [ByteString]
</span><a href="#local-6989586621679083632"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083631"><span class="annot"><span class="annottext">ivF :: ByteString
</span><a href="#local-6989586621679083631"><span class="hs-identifier hs-var">ivF</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083638"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083635"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083634"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083633"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083632"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083631"><span class="hs-identifier hs-var">ivF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeUnCfb"><span class="hs-pragma hs-type">modeUnCfb</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="hs-comment">-- |Obtain an `IV` using the provided CryptoRandomGenerator.</span><span>
</span><span id="line-310"></span><span id="local-6989586621679083629"><span id="local-6989586621679083630"><span class="annot"><a href="Crypto.Classes.html#getIV"><span class="hs-identifier hs-type">getIV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083630"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083629"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083629"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083630"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083629"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-311"></span><span id="getIV"><span class="annot"><span class="annottext">getIV :: g -&gt; Either GenError (IV k, g)
</span><a href="Crypto.Classes.html#getIV"><span class="hs-identifier hs-var hs-var">getIV</span></a></span></span><span> </span><span id="local-6989586621679083628"><span class="annot"><span class="annottext">g :: g
</span><a href="#local-6989586621679083628"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083627"><span class="annot"><span class="annottext">bytes :: ByteLength
</span><a href="#local-6989586621679083627"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IV k -&gt; ByteLength
forall k. BlockCipher k =&gt; IV k -&gt; ByteLength
</span><a href="Crypto.Classes.html#ivBlockSizeBytes"><span class="hs-identifier hs-var">ivBlockSizeBytes</span></a></span><span> </span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083625"><span class="hs-identifier hs-var">iv</span></a></span><span>
</span><span id="line-313"></span><span>            </span><span id="local-6989586621679083624"><span class="annot"><span class="annottext">gen :: Either GenError (ByteString, g)
</span><a href="#local-6989586621679083624"><span class="hs-identifier hs-var hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; g -&gt; Either GenError (ByteString, g)
forall g.
CryptoRandomGen g =&gt;
ByteLength -&gt; g -&gt; Either GenError (ByteString, g)
</span><a href="Crypto.Random.html#genBytes"><span class="hs-identifier hs-var">genBytes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083627"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679083628"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-314"></span><span>            </span><span id="local-6989586621679083622"><span class="annot"><span class="annottext">fromRight :: Either a b -&gt; b
</span><a href="#local-6989586621679083622"><span class="hs-identifier hs-var hs-var">fromRight</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679083621"><span class="annot"><span class="annottext">x :: b
</span><a href="#local-6989586621679083621"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679083621"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-315"></span><span>            </span><span id="local-6989586621679083625"><span class="annot"><span class="annottext">iv :: IV k
</span><a href="#local-6989586621679083625"><span class="hs-identifier hs-var hs-var">iv</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ByteString, g) -&gt; ByteString
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>  </span><span class="annot"><span class="annottext">((ByteString, g) -&gt; ByteString)
-&gt; (Either GenError (ByteString, g) -&gt; (ByteString, g))
-&gt; Either GenError (ByteString, g)
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Either GenError (ByteString, g) -&gt; (ByteString, g)
forall a b. Either a b -&gt; b
</span><a href="#local-6989586621679083622"><span class="hs-identifier hs-var">fromRight</span></a></span><span> </span><span class="annot"><span class="annottext">(Either GenError (ByteString, g) -&gt; ByteString)
-&gt; Either GenError (ByteString, g) -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either GenError (ByteString, g)
</span><a href="#local-6989586621679083624"><span class="hs-identifier hs-var">gen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either GenError (ByteString, g)
</span><a href="#local-6989586621679083624"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-317"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679083620"><span class="annot"><span class="annottext">err :: GenError
</span><a href="#local-6989586621679083620"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenError -&gt; Either GenError (IV k, g)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">GenError
</span><a href="#local-6989586621679083620"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-318"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083619"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679083619"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083618"><span class="annot"><span class="annottext">g' :: g
</span><a href="#local-6989586621679083618"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083619"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083627"><span class="hs-identifier hs-var">bytes</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(IV k, g) -&gt; Either GenError (IV k, g)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083625"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679083618"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenError -&gt; Either GenError (IV k, g)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GenError
</span><a href="Crypto.Random.html#GenErrorOther"><span class="hs-identifier hs-var">GenErrorOther</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Generator failed to provide requested number of bytes&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#getIV"><span class="hs-pragma hs-type">getIV</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">-- | Obtain an 'IV' using the system entropy (see 'System.Entropy')</span><span>
</span><span id="line-324"></span><span id="local-6989586621679083616"><span class="annot"><a href="Crypto.Classes.html#getIVIO"><span class="hs-identifier hs-type">getIVIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083616"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083616"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-325"></span><span id="getIVIO"><span class="annot"><span class="annottext">getIVIO :: IO (IV k)
</span><a href="Crypto.Classes.html#getIVIO"><span class="hs-identifier hs-var hs-var">getIVIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083615"><span class="annot"><span class="annottext">p :: Proxy t
</span><a href="#local-6989586621679083615"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy t
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-327"></span><span>            </span><span id="local-6989586621679083973"><span class="annot"><a href="#local-6989586621679083613"><span class="hs-identifier hs-type">getTypedIV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083973"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679083973"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083973"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-328"></span><span>            </span><span id="local-6989586621679083613"><span class="annot"><span class="annottext">getTypedIV :: Proxy k -&gt; IO (IV k)
</span><a href="#local-6989586621679083613"><span class="hs-identifier hs-var hs-var">getTypedIV</span></a></span></span><span> </span><span id="local-6989586621679083612"><span class="annot"><span class="annottext">pr :: Proxy k
</span><a href="#local-6989586621679083612"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k) -&gt; IO ByteString -&gt; IO (IV k)
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteLength -&gt; IO ByteString
</span><span class="hs-identifier hs-var">getEntropy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; Proxy k -&gt; ByteLength
forall k (s :: k) a (proxy :: k -&gt; *). Tagged s a -&gt; proxy s -&gt; a
</span><span class="hs-identifier hs-var">proxy</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy k
</span><a href="#local-6989586621679083612"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>        </span><span id="local-6989586621679083609"><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083609"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Proxy k -&gt; IO (IV k)
forall k. BlockCipher k =&gt; Proxy k -&gt; IO (IV k)
</span><a href="#local-6989586621679083613"><span class="hs-identifier hs-var">getTypedIV</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy k
forall t. Proxy t
</span><a href="#local-6989586621679083615"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-330"></span><span>        </span><span class="annot"><span class="annottext">IV k -&gt; IO (IV k)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083609"><span class="hs-identifier hs-var">iv</span></a></span><span> </span><span class="annot"><span class="annottext">IV k -&gt; Proxy (IV k) -&gt; IV k
forall a (proxy :: * -&gt; *). a -&gt; proxy a -&gt; a
</span><span class="hs-operator hs-var">`asProxyTypeOf`</span></span><span> </span><span class="annot"><span class="annottext">Proxy k -&gt; Proxy (IV k)
forall k. Proxy k -&gt; Proxy (IV k)
</span><a href="Crypto.Classes.html#ivProxy"><span class="hs-identifier hs-var">ivProxy</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy k
forall t. Proxy t
</span><a href="#local-6989586621679083615"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#getIVIO"><span class="hs-pragma hs-type">getIVIO</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span id="local-6989586621679083968"><span class="annot"><a href="Crypto.Classes.html#ivProxy"><span class="hs-identifier hs-type">ivProxy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679083968"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083968"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-334"></span><span id="ivProxy"><span class="annot"><span class="annottext">ivProxy :: Proxy k -&gt; Proxy (IV k)
</span><a href="Crypto.Classes.html#ivProxy"><span class="hs-identifier hs-var hs-var">ivProxy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy (IV k) -&gt; Proxy k -&gt; Proxy (IV k)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Proxy (IV k)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span id="local-6989586621679083851"><span class="annot"><a href="Crypto.Classes.html#deIVProxy"><span class="hs-identifier hs-type">deIVProxy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083851"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679083851"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-337"></span><span id="deIVProxy"><span class="annot"><span class="annottext">deIVProxy :: Proxy (IV k) -&gt; Proxy k
</span><a href="Crypto.Classes.html#deIVProxy"><span class="hs-identifier hs-var hs-var">deIVProxy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy k -&gt; Proxy (IV k) -&gt; Proxy k
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Proxy k
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="hs-comment">-- |Cook book mode - not really a mode at all.  If you don't know what you're doing, don't use this mode^H^H^H^H library.</span><span>
</span><span id="line-340"></span><span id="local-6989586621679084018"><span class="annot"><a href="Crypto.Classes.html#modeEcb"><span class="hs-identifier hs-type">modeEcb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084018"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084018"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span></span><span>
</span><span id="line-341"></span><span id="modeEcb"><span class="annot"><span class="annottext">modeEcb :: k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#modeEcb"><span class="hs-identifier hs-var hs-var">modeEcb</span></a></span></span><span> </span><span id="local-6989586621679083604"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083604"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679083603"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083603"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-342"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083602"><span class="annot"><span class="annottext">chunks :: [ByteString]
</span><a href="#local-6989586621679083602"><span class="hs-identifier hs-var hs-var">chunks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083604"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083603"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">L.fromChunks</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; [ByteString] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083604"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083602"><span class="hs-identifier hs-var">chunks</span></a></span><span>
</span><span id="line-344"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeEcb"><span class="hs-pragma hs-type">modeEcb</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="hs-comment">-- |ECB decrypt, complementary to `ecb`.</span><span>
</span><span id="line-347"></span><span id="local-6989586621679083601"><span class="annot"><a href="Crypto.Classes.html#modeUnEcb"><span class="hs-identifier hs-type">modeUnEcb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083601"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083601"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span></span><span>
</span><span id="line-348"></span><span id="modeUnEcb"><span class="annot"><span class="annottext">modeUnEcb :: k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#modeUnEcb"><span class="hs-identifier hs-var hs-var">modeUnEcb</span></a></span></span><span> </span><span id="local-6989586621679083600"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083600"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679083599"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083599"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-349"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083598"><span class="annot"><span class="annottext">chunks :: [ByteString]
</span><a href="#local-6989586621679083598"><span class="hs-identifier hs-var hs-var">chunks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083600"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083599"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-350"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">L.fromChunks</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; [ByteString] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#decryptBlock"><span class="hs-identifier hs-var">decryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083600"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083598"><span class="hs-identifier hs-var">chunks</span></a></span><span>
</span><span id="line-351"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeUnEcb"><span class="hs-pragma hs-type">modeUnEcb</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-comment">-- |SIV (Synthetic IV) mode for lazy bytestrings. The third argument is</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- the optional list of bytestrings to be authenticated but not</span><span>
</span><span id="line-355"></span><span class="hs-comment">-- encrypted As required by the specification this algorithm may</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- return nothing when certain constraints aren't met.</span><span>
</span><span id="line-357"></span><span id="local-6989586621679084020"><span class="annot"><a href="Crypto.Classes.html#modeSiv"><span class="hs-identifier hs-type">modeSiv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084020"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084020"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084020"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span></span><span>
</span><span id="line-358"></span><span id="modeSiv"><span class="annot"><span class="annottext">modeSiv :: k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Crypto.Classes.html#modeSiv"><span class="hs-identifier hs-var hs-var">modeSiv</span></a></span></span><span> </span><span id="local-6989586621679083597"><span class="annot"><span class="annottext">k1 :: k
</span><a href="#local-6989586621679083597"><span class="hs-identifier hs-var">k1</span></a></span></span><span> </span><span id="local-6989586621679083596"><span class="annot"><span class="annottext">k2 :: k
</span><a href="#local-6989586621679083596"><span class="hs-identifier hs-var">k2</span></a></span></span><span> </span><span id="local-6989586621679083595"><span class="annot"><span class="annottext">xs :: [ByteString]
</span><a href="#local-6989586621679083595"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679083594"><span class="annot"><span class="annottext">m :: ByteString
</span><a href="#local-6989586621679083594"><span class="hs-identifier hs-var">m</span></a></span></span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteLength
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ByteLength
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083595"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083591"><span class="hs-identifier hs-var">bSizeb</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-361"></span><span>                </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe ByteString)
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; Maybe ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">L.append</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083589"><span class="hs-identifier hs-var">iv</span></a></span><span>
</span><span id="line-362"></span><span>                </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ByteString, IV k) -&gt; ByteString
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-363"></span><span>                </span><span class="annot"><span class="annottext">((ByteString, IV k) -&gt; ByteString)
-&gt; (ByteString -&gt; (ByteString, IV k)) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#ctrLazy"><span class="hs-identifier hs-var">ctrLazy</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083596"><span class="hs-identifier hs-var">k2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k)
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; IV k
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#sivMask"><span class="hs-identifier hs-var">sivMask</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString)
-&gt; (ByteString -&gt; [ByteString]) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">L.toChunks</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k) -&gt; ByteString -&gt; IV k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083589"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>                </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe ByteString) -&gt; ByteString -&gt; Maybe ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083594"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-366"></span><span>       </span><span id="local-6989586621679083587"><span class="annot"><span class="annottext">bSize :: Integer
</span><a href="#local-6989586621679083587"><span class="hs-identifier hs-var hs-var">bSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; Integer) -&gt; ByteLength -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var">blockSizeBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; k -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#for"><span class="hs-operator hs-var">`for`</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083597"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-367"></span><span>       </span><span id="local-6989586621679083591"><span class="annot"><span class="annottext">bSizeb :: ByteLength
</span><a href="#local-6989586621679083591"><span class="hs-identifier hs-var hs-var">bSizeb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; ByteLength) -&gt; ByteLength -&gt; ByteLength
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; k -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#for"><span class="hs-operator hs-var">`for`</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083597"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-368"></span><span>       </span><span id="local-6989586621679083589"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083589"><span class="hs-identifier hs-var hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; [ByteString] -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; [ByteString] -&gt; ByteString
</span><a href="Crypto.Modes.html#cMacStar"><span class="hs-identifier hs-var">cMacStar</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083597"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083595"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; [ByteString] -&gt; [ByteString]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083594"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">-- |SIV (Synthetic IV) for lazy bytestrings.  The third argument is the</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- optional list of bytestrings to be authenticated but not encrypted.</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- As required by the specification this algorithm may return nothing</span><span>
</span><span id="line-374"></span><span class="hs-comment">-- when authentication fails.</span><span>
</span><span id="line-375"></span><span id="local-6989586621679083585"><span class="annot"><a href="Crypto.Classes.html#modeUnSiv"><span class="hs-identifier hs-type">modeUnSiv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083585"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083585"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083585"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span></span><span>
</span><span id="line-376"></span><span id="modeUnSiv"><span class="annot"><span class="annottext">modeUnSiv :: k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Crypto.Classes.html#modeUnSiv"><span class="hs-identifier hs-var hs-var">modeUnSiv</span></a></span></span><span> </span><span id="local-6989586621679083584"><span class="annot"><span class="annottext">k1 :: k
</span><a href="#local-6989586621679083584"><span class="hs-identifier hs-var">k1</span></a></span></span><span> </span><span id="local-6989586621679083583"><span class="annot"><span class="annottext">k2 :: k
</span><a href="#local-6989586621679083583"><span class="hs-identifier hs-var">k2</span></a></span></span><span> </span><span id="local-6989586621679083582"><span class="annot"><span class="annottext">xs :: [ByteString]
</span><a href="#local-6989586621679083582"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679083581"><span class="annot"><span class="annottext">c :: ByteString
</span><a href="#local-6989586621679083581"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteLength
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ByteLength
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083582"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083580"><span class="hs-identifier hs-var">bSizeb</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-377"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><span class="hs-identifier hs-var">L.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083581"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679083578"><span class="hs-identifier hs-var">bSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-378"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083577"><span class="hs-identifier hs-var">iv</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; [ByteString] -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; [ByteString] -&gt; ByteString
</span><a href="Crypto.Modes.html#cMacStar"><span class="hs-identifier hs-var">cMacStar</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083584"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083582"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; [ByteString] -&gt; [ByteString]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083575"><span class="hs-identifier hs-var">dm</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-379"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083575"><span class="hs-identifier hs-var">dm</span></a></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-381"></span><span>       </span><span id="local-6989586621679083578"><span class="annot"><span class="annottext">bSize :: Integer
</span><a href="#local-6989586621679083578"><span class="hs-identifier hs-var hs-var">bSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; Integer) -&gt; ByteLength -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var">blockSizeBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; k -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#for"><span class="hs-operator hs-var">`for`</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083584"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-382"></span><span>       </span><span id="local-6989586621679083580"><span class="annot"><span class="annottext">bSizeb :: ByteLength
</span><a href="#local-6989586621679083580"><span class="hs-identifier hs-var hs-var">bSizeb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; ByteLength) -&gt; ByteLength -&gt; ByteLength
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; k -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#for"><span class="hs-operator hs-var">`for`</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083584"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-383"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621679083577"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083577"><span class="hs-identifier hs-var">iv</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083574"><span class="annot"><span class="annottext">m :: ByteString
</span><a href="#local-6989586621679083574"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">L.splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679083578"><span class="hs-identifier hs-var">bSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083581"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-384"></span><span>       </span><span id="local-6989586621679083575"><span class="annot"><span class="annottext">dm :: ByteString
</span><a href="#local-6989586621679083575"><span class="hs-identifier hs-var hs-var">dm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString, IV k) -&gt; ByteString
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((ByteString, IV k) -&gt; ByteString)
-&gt; (ByteString, IV k) -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCtr"><span class="hs-identifier hs-var">modeUnCtr</span></a></span><span> </span><span class="annot"><span class="annottext">IV k -&gt; IV k
forall k. BlockCipher k =&gt; IV k -&gt; IV k
</span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var">incIV</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083583"><span class="hs-identifier hs-var">k2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k) -&gt; ByteString -&gt; IV k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#sivMask"><span class="hs-identifier hs-var">sivMask</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">L.toChunks</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083577"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083574"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-comment">-- |SIV (Synthetic IV) mode for strict bytestrings.  First argument is</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- the optional list of bytestrings to be authenticated but not</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- encrypted.  As required by the specification this algorithm may</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- return nothing when certain constraints aren't met.</span><span>
</span><span id="line-390"></span><span id="local-6989586621679084019"><span class="annot"><a href="Crypto.Classes.html#modeSiv%27"><span class="hs-identifier hs-type">modeSiv'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084019"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084019"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084019"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span></span><span>
</span><span id="line-391"></span><span id="modeSiv%27"><span class="annot"><span class="annottext">modeSiv' :: k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Crypto.Classes.html#modeSiv%27"><span class="hs-identifier hs-var hs-var">modeSiv'</span></a></span></span><span> </span><span id="local-6989586621679083572"><span class="annot"><span class="annottext">k1 :: k
</span><a href="#local-6989586621679083572"><span class="hs-identifier hs-var">k1</span></a></span></span><span> </span><span id="local-6989586621679083571"><span class="annot"><span class="annottext">k2 :: k
</span><a href="#local-6989586621679083571"><span class="hs-identifier hs-var">k2</span></a></span></span><span> </span><span id="local-6989586621679083570"><span class="annot"><span class="annottext">xs :: [ByteString]
</span><a href="#local-6989586621679083570"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679083569"><span class="annot"><span class="annottext">m :: ByteString
</span><a href="#local-6989586621679083569"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteLength
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ByteLength
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083570"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083568"><span class="hs-identifier hs-var">bSizeb</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-392"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe ByteString) -&gt; ByteString -&gt; Maybe ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B.append</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083567"><span class="hs-identifier hs-var">iv</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString, IV k) -&gt; ByteString
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((ByteString, IV k) -&gt; ByteString)
-&gt; (ByteString, IV k) -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#ctr"><span class="hs-identifier hs-var">Crypto.Classes.ctr</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083571"><span class="hs-identifier hs-var">k2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k) -&gt; ByteString -&gt; IV k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#sivMask"><span class="hs-identifier hs-var">sivMask</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083567"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083569"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-394"></span><span>       </span><span id="local-6989586621679083566"><span class="annot"><span class="annottext">bSize :: Integer
</span><a href="#local-6989586621679083566"><span class="hs-identifier hs-var hs-var">bSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; Integer) -&gt; ByteLength -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var">blockSizeBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; k -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#for"><span class="hs-operator hs-var">`for`</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083572"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-395"></span><span>       </span><span id="local-6989586621679083568"><span class="annot"><span class="annottext">bSizeb :: ByteLength
</span><a href="#local-6989586621679083568"><span class="hs-identifier hs-var hs-var">bSizeb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; ByteLength) -&gt; ByteLength -&gt; ByteLength
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; k -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#for"><span class="hs-operator hs-var">`for`</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083572"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-396"></span><span>       </span><span id="local-6989586621679083567"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083567"><span class="hs-identifier hs-var hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; [ByteString] -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; [ByteString] -&gt; ByteString
</span><a href="Crypto.Modes.html#cMacStar%27"><span class="hs-identifier hs-var">cMacStar'</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083572"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083570"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; [ByteString] -&gt; [ByteString]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083569"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="hs-comment">-- |SIV (Synthetic IV) for strict bytestrings First argument is the</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- optional list of bytestrings to be authenticated but not encrypted</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- As required by the specification this algorithm may return nothing</span><span>
</span><span id="line-401"></span><span class="hs-comment">-- when authentication fails.</span><span>
</span><span id="line-402"></span><span id="local-6989586621679083564"><span class="annot"><a href="Crypto.Classes.html#modeUnSiv%27"><span class="hs-identifier hs-type">modeUnSiv'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083564"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083564"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083564"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span></span><span>
</span><span id="line-403"></span><span id="modeUnSiv%27"><span class="annot"><span class="annottext">modeUnSiv' :: k -&gt; k -&gt; [ByteString] -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Crypto.Classes.html#modeUnSiv%27"><span class="hs-identifier hs-var hs-var">modeUnSiv'</span></a></span></span><span> </span><span id="local-6989586621679083563"><span class="annot"><span class="annottext">k1 :: k
</span><a href="#local-6989586621679083563"><span class="hs-identifier hs-var">k1</span></a></span></span><span> </span><span id="local-6989586621679083562"><span class="annot"><span class="annottext">k2 :: k
</span><a href="#local-6989586621679083562"><span class="hs-identifier hs-var">k2</span></a></span></span><span> </span><span id="local-6989586621679083561"><span class="annot"><span class="annottext">xs :: [ByteString]
</span><a href="#local-6989586621679083561"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679083560"><span class="annot"><span class="annottext">c :: ByteString
</span><a href="#local-6989586621679083560"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteLength
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ByteLength
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083561"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083559"><span class="hs-identifier hs-var">bSizeb</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-404"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083560"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083558"><span class="hs-identifier hs-var">bSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-405"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083557"><span class="hs-identifier hs-var">iv</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; [ByteString] -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; [ByteString] -&gt; ByteString
</span><a href="Crypto.Modes.html#cMacStar%27"><span class="hs-identifier hs-var">cMacStar'</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083563"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083561"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; [ByteString] -&gt; [ByteString]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083556"><span class="hs-identifier hs-var">dm</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-406"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083556"><span class="hs-identifier hs-var">dm</span></a></span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-408"></span><span>       </span><span id="local-6989586621679083558"><span class="annot"><span class="annottext">bSize :: ByteLength
</span><a href="#local-6989586621679083558"><span class="hs-identifier hs-var hs-var">bSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; ByteLength) -&gt; ByteLength -&gt; ByteLength
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var">blockSizeBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; k -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#for"><span class="hs-operator hs-var">`for`</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083563"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-409"></span><span>       </span><span id="local-6989586621679083559"><span class="annot"><span class="annottext">bSizeb :: ByteLength
</span><a href="#local-6989586621679083559"><span class="hs-identifier hs-var hs-var">bSizeb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; ByteLength) -&gt; ByteLength -&gt; ByteLength
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; k -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#for"><span class="hs-operator hs-var">`for`</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083563"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-410"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621679083557"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083557"><span class="hs-identifier hs-var">iv</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083555"><span class="annot"><span class="annottext">m :: ByteString
</span><a href="#local-6989586621679083555"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">B.splitAt</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083558"><span class="hs-identifier hs-var">bSize</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083560"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-411"></span><span>       </span><span id="local-6989586621679083556"><span class="annot"><span class="annottext">dm :: ByteString
</span><a href="#local-6989586621679083556"><span class="hs-identifier hs-var hs-var">dm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString, IV k) -&gt; ByteString
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((ByteString, IV k) -&gt; ByteString)
-&gt; (ByteString, IV k) -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#unCtr"><span class="hs-identifier hs-var">Crypto.Classes.unCtr</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083562"><span class="hs-identifier hs-var">k2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k) -&gt; ByteString -&gt; IV k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#sivMask"><span class="hs-identifier hs-var">sivMask</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083557"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083555"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span id="local-6989586621679084021"><span class="annot"><a href="Crypto.Classes.html#modeCbc"><span class="hs-identifier hs-type">modeCbc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084021"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084021"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084021"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084021"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-415"></span><span id="modeCbc"><span class="annot"><span class="annottext">modeCbc :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCbc"><span class="hs-identifier hs-var hs-var">modeCbc</span></a></span></span><span> </span><span id="local-6989586621679083554"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083554"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083553"><span class="annot"><span class="annottext">v :: ByteString
</span><a href="#local-6989586621679083553"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083552"><span class="annot"><span class="annottext">plaintext :: ByteString
</span><a href="#local-6989586621679083552"><span class="hs-identifier hs-var">plaintext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-416"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083551"><span class="annot"><span class="annottext">blks :: [ByteString]
</span><a href="#local-6989586621679083551"><span class="hs-identifier hs-var hs-var">blks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083554"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083552"><span class="hs-identifier hs-var">plaintext</span></a></span><span>
</span><span id="line-417"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083550"><span class="annot"><span class="annottext">cts :: [ByteString]
</span><a href="#local-6989586621679083550"><span class="hs-identifier hs-var">cts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083549"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083549"><span class="hs-identifier hs-var">iv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083548"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083551"><span class="hs-identifier hs-var">blks</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083553"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-418"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">L.fromChunks</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083550"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083549"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-420"></span><span>  </span><span id="local-6989586621679083548"><span class="annot"><span class="annottext">go :: [ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083548"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679083547"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083547"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083547"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>  </span><span class="annot"><a href="#local-6989586621679083548"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083546"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621679083546"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083545"><span class="annot"><span class="annottext">bs :: [ByteString]
</span><a href="#local-6989586621679083545"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083544"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083544"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-422"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083543"><span class="annot"><span class="annottext">c :: ByteString
</span><a href="#local-6989586621679083543"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083554"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083544"><span class="hs-identifier hs-var">iv</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083546"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083542"><span class="annot"><span class="annottext">cs :: [ByteString]
</span><a href="#local-6989586621679083542"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083541"><span class="annot"><span class="annottext">ivFinal :: ByteString
</span><a href="#local-6989586621679083541"><span class="hs-identifier hs-var">ivFinal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083548"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083545"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083543"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083543"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083542"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083541"><span class="hs-identifier hs-var">ivFinal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeCbc"><span class="hs-pragma hs-type">modeCbc</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span id="local-6989586621679083540"><span class="annot"><a href="Crypto.Classes.html#modeUnCbc"><span class="hs-identifier hs-type">modeUnCbc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083540"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083540"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083540"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083540"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-428"></span><span id="modeUnCbc"><span class="annot"><span class="annottext">modeUnCbc :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCbc"><span class="hs-identifier hs-var hs-var">modeUnCbc</span></a></span></span><span> </span><span id="local-6989586621679083539"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083539"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083538"><span class="annot"><span class="annottext">v :: ByteString
</span><a href="#local-6989586621679083538"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083537"><span class="annot"><span class="annottext">ciphertext :: ByteString
</span><a href="#local-6989586621679083537"><span class="hs-identifier hs-var">ciphertext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-429"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083536"><span class="annot"><span class="annottext">blks :: [ByteString]
</span><a href="#local-6989586621679083536"><span class="hs-identifier hs-var hs-var">blks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083539"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083537"><span class="hs-identifier hs-var">ciphertext</span></a></span><span>
</span><span id="line-430"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083535"><span class="annot"><span class="annottext">pts :: [ByteString]
</span><a href="#local-6989586621679083535"><span class="hs-identifier hs-var">pts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083534"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083534"><span class="hs-identifier hs-var">iv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083533"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083536"><span class="hs-identifier hs-var">blks</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083538"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-431"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">L.fromChunks</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083535"><span class="hs-identifier hs-var">pts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083534"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-433"></span><span>  </span><span id="local-6989586621679083533"><span class="annot"><span class="annottext">go :: [ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083533"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679083532"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083532"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083532"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>  </span><span class="annot"><a href="#local-6989586621679083533"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083531"><span class="annot"><span class="annottext">c :: ByteString
</span><a href="#local-6989586621679083531"><span class="hs-identifier hs-var">c</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083530"><span class="annot"><span class="annottext">cs :: [ByteString]
</span><a href="#local-6989586621679083530"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083529"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083529"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-435"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083528"><span class="annot"><span class="annottext">p :: ByteString
</span><a href="#local-6989586621679083528"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#decryptBlock"><span class="hs-identifier hs-var">decryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083539"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083531"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083529"><span class="hs-identifier hs-var">iv</span></a></span><span>
</span><span id="line-436"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083527"><span class="annot"><span class="annottext">ps :: [ByteString]
</span><a href="#local-6989586621679083527"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083526"><span class="annot"><span class="annottext">ivFinal :: ByteString
</span><a href="#local-6989586621679083526"><span class="hs-identifier hs-var">ivFinal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083533"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083530"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083531"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-437"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083528"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083527"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083526"><span class="hs-identifier hs-var">ivFinal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeUnCbc"><span class="hs-pragma hs-type">modeUnCbc</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="hs-comment">-- |Counter mode for lazy bytestrings</span><span>
</span><span id="line-441"></span><span id="local-6989586621679084022"><span class="annot"><a href="Crypto.Classes.html#modeCtr"><span class="hs-identifier hs-type">modeCtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084022"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084022"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084022"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084022"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084022"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084022"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-442"></span><span id="modeCtr"><span class="annot"><span class="annottext">modeCtr :: (IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCtr"><span class="hs-identifier hs-var hs-var">modeCtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCtr"><span class="hs-identifier hs-var">modeUnCtr</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-comment">-- |Counter  mode for lazy bytestrings</span><span>
</span><span id="line-445"></span><span id="local-6989586621679083525"><span class="annot"><a href="Crypto.Classes.html#modeUnCtr"><span class="hs-identifier hs-type">modeUnCtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083525"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083525"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083525"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083525"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083525"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083525"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-446"></span><span id="modeUnCtr"><span class="annot"><span class="annottext">modeUnCtr :: (IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCtr"><span class="hs-identifier hs-var hs-var">modeUnCtr</span></a></span></span><span> </span><span id="local-6989586621679083524"><span class="annot"><span class="annottext">f :: IV k -&gt; IV k
</span><a href="#local-6989586621679083524"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679083523"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083523"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083522"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083522"><span class="hs-identifier hs-var">iv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083521"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083521"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-447"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083520"><span class="annot"><span class="annottext">ivStr :: [IV k]
</span><a href="#local-6989586621679083520"><span class="hs-identifier hs-var hs-var">ivStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IV k -&gt; IV k) -&gt; IV k -&gt; [IV k]
forall a. (a -&gt; a) -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">iterate</span></span><span> </span><span class="annot"><span class="annottext">IV k -&gt; IV k
</span><a href="#local-6989586621679083524"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(IV k -&gt; [IV k]) -&gt; IV k -&gt; [IV k]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083522"><span class="hs-identifier hs-var">iv</span></a></span><span>
</span><span id="line-448"></span><span>           </span><span id="local-6989586621679083519"><span class="annot"><span class="annottext">ivLen :: Int64
</span><a href="#local-6989586621679083519"><span class="hs-identifier hs-var hs-var">ivLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; Int64) -&gt; ByteLength -&gt; Int64
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083522"><span class="hs-identifier hs-var">iv</span></a></span><span>
</span><span id="line-449"></span><span>           </span><span id="local-6989586621679083518"><span class="annot"><span class="annottext">newIV :: IV k
</span><a href="#local-6989586621679083518"><span class="hs-identifier hs-var hs-var">newIV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IV k] -&gt; IV k
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">([IV k] -&gt; IV k) -&gt; [IV k] -&gt; IV k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; [IV k] -&gt; [IV k]
forall i a. Integral i =&gt; i -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">genericDrop</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679083519"><span class="hs-identifier hs-var">ivLen</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Int64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Int64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><span class="hs-identifier hs-var">L.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083521"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Int64
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679083519"><span class="hs-identifier hs-var">ivLen</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[IV k]
</span><a href="#local-6989586621679083520"><span class="hs-identifier hs-var">ivStr</span></a></span><span>
</span><span id="line-450"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Util.html#zwp"><span class="hs-identifier hs-var">zwp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">L.fromChunks</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; [ByteString] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083523"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; [ByteString]) -&gt; [ByteString] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(IV k -&gt; ByteString) -&gt; [IV k] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">IV k -&gt; ByteString
forall k. IV k -&gt; ByteString
</span><a href="Crypto.Types.html#initializationVector"><span class="hs-identifier hs-var hs-var">initializationVector</span></a></span><span> </span><span class="annot"><span class="annottext">[IV k]
</span><a href="#local-6989586621679083520"><span class="hs-identifier hs-var">ivStr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083521"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083518"><span class="hs-identifier hs-var">newIV</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span class="hs-comment">-- |The number of bytes in a block cipher block</span><span>
</span><span id="line-454"></span><span id="local-6989586621679083514"><span class="annot"><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-type">blockSizeBytes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083514"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tagged</span></span><span> </span><span class="annot"><a href="#local-6989586621679083514"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Crypto.Types.html#ByteLength"><span class="hs-identifier hs-type">ByteLength</span></a></span></span><span>
</span><span id="line-455"></span><span id="blockSizeBytes"><span class="annot"><span class="annottext">blockSizeBytes :: Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var hs-var">blockSizeBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; ByteLength)
-&gt; Tagged k ByteLength -&gt; Tagged k ByteLength
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-comment">-- |The number of bytes in a block cipher key (assuming it is an even</span><span>
</span><span id="line-458"></span><span class="hs-comment">-- multiple of 8 bits)</span><span>
</span><span id="line-459"></span><span id="local-6989586621679083513"><span class="annot"><a href="Crypto.Classes.html#keyLengthBytes"><span class="hs-identifier hs-type">keyLengthBytes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083513"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tagged</span></span><span> </span><span class="annot"><a href="#local-6989586621679083513"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Crypto.Types.html#ByteLength"><span class="hs-identifier hs-type">ByteLength</span></a></span></span><span>
</span><span id="line-460"></span><span id="keyLengthBytes"><span class="annot"><span class="annottext">keyLengthBytes :: Tagged k ByteLength
</span><a href="Crypto.Classes.html#keyLengthBytes"><span class="hs-identifier hs-var hs-var">keyLengthBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; ByteLength)
-&gt; Tagged k ByteLength -&gt; Tagged k ByteLength
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#keyLength"><span class="hs-identifier hs-var">keyLength</span></a></span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span class="hs-comment">-- |Build a symmetric key using the system entropy (see 'System.Entropy')</span><span>
</span><span id="line-463"></span><span id="local-6989586621679083512"><span class="annot"><a href="Crypto.Classes.html#buildKeyIO"><span class="hs-identifier hs-type">buildKeyIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083512"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679083512"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-464"></span><span id="buildKeyIO"><span class="annot"><span class="annottext">buildKeyIO :: IO k
</span><a href="Crypto.Classes.html#buildKeyIO"><span class="hs-identifier hs-var hs-var">buildKeyIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; IO ByteString) -&gt; (String -&gt; IO k) -&gt; IO k
forall k (m :: * -&gt; *).
(BlockCipher k, Monad m) =&gt;
(ByteLength -&gt; m ByteString) -&gt; (String -&gt; m k) -&gt; m k
</span><a href="Crypto.Classes.html#buildKeyM"><span class="hs-identifier hs-var">buildKeyM</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; IO ByteString
</span><span class="hs-identifier hs-var">getEntropy</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO k
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="hs-comment">-- |Build a symmetric key using a given 'Crypto.Random.CryptoRandomGen'</span><span>
</span><span id="line-467"></span><span id="local-6989586621679083509"><span id="local-6989586621679083510"><span class="annot"><a href="Crypto.Classes.html#buildKeyGen"><span class="hs-identifier hs-type">buildKeyGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083510"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083509"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083509"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083510"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083509"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-468"></span><span id="buildKeyGen"><span class="annot"><span class="annottext">buildKeyGen :: g -&gt; Either GenError (k, g)
</span><a href="Crypto.Classes.html#buildKeyGen"><span class="hs-identifier hs-var hs-var">buildKeyGen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT g (Either GenError) k -&gt; g -&gt; Either GenError (k, g)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ByteLength -&gt; StateT g (Either GenError) ByteString)
-&gt; (String -&gt; StateT g (Either GenError) k)
-&gt; StateT g (Either GenError) k
forall k (m :: * -&gt; *).
(BlockCipher k, Monad m) =&gt;
(ByteLength -&gt; m ByteString) -&gt; (String -&gt; m k) -&gt; m k
</span><a href="Crypto.Classes.html#buildKeyM"><span class="hs-identifier hs-var">buildKeyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(g -&gt; Either GenError (ByteString, g))
-&gt; StateT g (Either GenError) ByteString
forall s (m :: * -&gt; *) a. (s -&gt; m (a, s)) -&gt; StateT s m a
</span><span class="hs-identifier hs-var">StateT</span></span><span> </span><span class="annot"><span class="annottext">((g -&gt; Either GenError (ByteString, g))
 -&gt; StateT g (Either GenError) ByteString)
-&gt; (ByteLength -&gt; g -&gt; Either GenError (ByteString, g))
-&gt; ByteLength
-&gt; StateT g (Either GenError) ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; g -&gt; Either GenError (ByteString, g)
forall g.
CryptoRandomGen g =&gt;
ByteLength -&gt; g -&gt; Either GenError (ByteString, g)
</span><a href="Crypto.Random.html#genBytes"><span class="hs-identifier hs-var">genBytes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either GenError k -&gt; StateT g (Either GenError) k
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Either GenError k -&gt; StateT g (Either GenError) k)
-&gt; (String -&gt; Either GenError k)
-&gt; String
-&gt; StateT g (Either GenError) k
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenError -&gt; Either GenError k
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(GenError -&gt; Either GenError k)
-&gt; (String -&gt; GenError) -&gt; String -&gt; Either GenError k
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; GenError
</span><a href="Crypto.Random.html#GenErrorOther"><span class="hs-identifier hs-var">GenErrorOther</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span id="local-6989586621679083937"><span id="local-6989586621679083938"><span class="annot"><a href="Crypto.Classes.html#buildKeyM"><span class="hs-identifier hs-type">buildKeyM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083938"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679083937"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083937"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083937"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083938"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083937"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083938"><span class="hs-identifier hs-type">k</span></a></span></span></span><span>
</span><span id="line-471"></span><span id="buildKeyM"><span class="annot"><span class="annottext">buildKeyM :: (ByteLength -&gt; m ByteString) -&gt; (String -&gt; m k) -&gt; m k
</span><a href="Crypto.Classes.html#buildKeyM"><span class="hs-identifier hs-var hs-var">buildKeyM</span></a></span></span><span> </span><span id="local-6989586621679083507"><span class="annot"><span class="annottext">getMore :: ByteLength -&gt; m ByteString
</span><a href="#local-6989586621679083507"><span class="hs-identifier hs-var">getMore</span></a></span></span><span> </span><span id="local-6989586621679083506"><span class="annot"><span class="annottext">err :: String -&gt; m k
</span><a href="#local-6989586621679083506"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; m k
forall t. (Eq t, Num t) =&gt; t -&gt; m k
</span><a href="#local-6989586621679083505"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-473"></span><span>  </span><span id="local-6989586621679083505"><span class="annot"><span class="annottext">go :: t -&gt; m k
</span><a href="#local-6989586621679083505"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-number">1000</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m k
</span><a href="#local-6989586621679083506"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tried 1000 times to generate a key from the system entropy.\
                \  No keys were returned! Perhaps the system entropy is broken\
                \ or perhaps the BlockCipher instance being used has a non-flat\
                \ keyspace.&quot;</span></span><span>
</span><span id="line-477"></span><span>  </span><span class="annot"><a href="#local-6989586621679083505"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679083504"><span class="annot"><span class="annottext">i :: t
</span><a href="#local-6989586621679083504"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083503"><span class="annot"><span class="annottext">bs :: Tagged k ByteLength
</span><a href="#local-6989586621679083503"><span class="hs-identifier hs-var hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#keyLength"><span class="hs-identifier hs-var">keyLength</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span id="local-6989586621679083502"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083502"><span class="hs-identifier hs-var">kd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; m ByteString
</span><a href="#local-6989586621679083507"><span class="hs-identifier hs-var">getMore</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; ByteLength
forall k (s :: k) b. Tagged s b -&gt; b
</span><span class="hs-identifier hs-var">untag</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
</span><a href="#local-6989586621679083503"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe k
forall k. BlockCipher k =&gt; ByteString -&gt; Maybe k
</span><a href="Crypto.Classes.html#buildKey"><span class="hs-identifier hs-var">buildKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083502"><span class="hs-identifier hs-var">kd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-481"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; m k
</span><a href="#local-6989586621679083505"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679083504"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679083500"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083500"><span class="hs-identifier hs-var">k</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">k -&gt; m k
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(k -&gt; m k) -&gt; k -&gt; m k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083500"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">k -&gt; Tagged k ByteLength -&gt; k
forall k s (tagged :: * -&gt; k -&gt; *) (b :: k). s -&gt; tagged s b -&gt; s
</span><span class="hs-operator hs-var">`asTaggedTypeOf`</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
</span><a href="#local-6989586621679083503"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span class="hs-comment">-- |Asymetric ciphers (common ones being RSA or EC based)</span><span>
</span><span id="line-485"></span><span class="hs-keyword">class</span><span> </span><span id="AsymCipher"><span class="annot"><a href="Crypto.Classes.html#AsymCipher"><span class="hs-identifier hs-var">AsymCipher</span></a></span></span><span> </span><span id="local-6989586621679083908"><span class="annot"><a href="#local-6989586621679083908"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621679083907"><span class="annot"><a href="#local-6989586621679083907"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679083908"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083907"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083907"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083908"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-486"></span><span>  </span><span id="local-6989586621679083905"><span id="buildKeyPair"><span class="annot"><a href="Crypto.Classes.html#buildKeyPair"><span class="hs-identifier hs-type">buildKeyPair</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083905"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083905"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083908"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083907"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083905"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ build a public/private key pair using the provided generator</span></span><span>
</span><span id="line-487"></span><span>  </span><span id="local-6989586621679083497"><span id="encryptAsym"><span class="annot"><a href="Crypto.Classes.html#encryptAsym"><span class="hs-identifier hs-type">encryptAsym</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083497"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083497"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083908"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083497"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Asymetric encryption</span></span><span>
</span><span id="line-488"></span><span>  </span><span id="local-6989586621679083495"><span id="decryptAsym"><span class="annot"><a href="Crypto.Classes.html#decryptAsym"><span class="hs-identifier hs-type">decryptAsym</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083495"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083495"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083907"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083495"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Asymetric decryption</span></span><span>
</span><span id="line-489"></span><span>  </span><span id="publicKeyLength"><span class="annot"><a href="Crypto.Classes.html#publicKeyLength"><span class="hs-identifier hs-type">publicKeyLength</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679083908"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span>
</span><span id="line-490"></span><span>  </span><span id="privateKeyLength"><span class="annot"><a href="Crypto.Classes.html#privateKeyLength"><span class="hs-identifier hs-type">privateKeyLength</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679083907"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span class="hs-comment">-- |Build a pair of asymmetric keys using the system random generator.</span><span>
</span><span id="line-493"></span><span class="hs-comment">--   WARNING: This function opens a file handle which will never be closed!</span><span>
</span><span id="line-494"></span><span id="local-6989586621679083490"><span id="local-6989586621679083491"><span class="annot"><a href="Crypto.Classes.html#buildKeyPairIO"><span class="hs-identifier hs-type">buildKeyPairIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#AsymCipher"><span class="hs-identifier hs-type">AsymCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083491"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083490"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083491"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083490"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-495"></span><span id="buildKeyPairIO"><span class="annot"><span class="annottext">buildKeyPairIO :: ByteLength -&gt; IO (Either GenError (p, v))
</span><a href="Crypto.Classes.html#buildKeyPairIO"><span class="hs-identifier hs-var hs-var">buildKeyPairIO</span></a></span></span><span> </span><span id="local-6989586621679083489"><span class="annot"><span class="annottext">bl :: ByteLength
</span><a href="#local-6989586621679083489"><span class="hs-identifier hs-var">bl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-496"></span><span>        </span><span id="local-6989586621679083488"><span class="annot"><span class="annottext">SystemRandom
</span><a href="#local-6989586621679083488"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SystemRandom
forall g. CryptoRandomGen g =&gt; IO g
</span><a href="Crypto.Random.html#newGenIO"><span class="hs-identifier hs-var">newGenIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#SystemRandom"><span class="hs-identifier hs-type">SystemRandom</span></a></span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SystemRandom
-&gt; ByteLength -&gt; Either GenError ((p, v), SystemRandom)
forall p v g.
(AsymCipher p v, CryptoRandomGen g) =&gt;
g -&gt; ByteLength -&gt; Either GenError ((p, v), g)
</span><a href="Crypto.Classes.html#buildKeyPair"><span class="hs-identifier hs-var">buildKeyPair</span></a></span><span> </span><span class="annot"><span class="annottext">SystemRandom
</span><a href="#local-6989586621679083488"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083489"><span class="hs-identifier hs-var">bl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-498"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679083486"><span class="annot"><span class="annottext">err :: GenError
</span><a href="#local-6989586621679083486"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either GenError (p, v) -&gt; IO (Either GenError (p, v))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenError -&gt; Either GenError (p, v)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">GenError
</span><a href="#local-6989586621679083486"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083485"><span class="annot"><span class="annottext">k :: (p, v)
</span><a href="#local-6989586621679083485"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either GenError (p, v) -&gt; IO (Either GenError (p, v))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(p, v) -&gt; Either GenError (p, v)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(p, v)
</span><a href="#local-6989586621679083485"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span class="hs-comment">-- |Flipped 'buildKeyPair' for ease of use with state monads.</span><span>
</span><span id="line-502"></span><span id="local-6989586621679083482"><span id="local-6989586621679083483"><span id="local-6989586621679083484"><span class="annot"><a href="Crypto.Classes.html#buildKeyPairGen"><span class="hs-identifier hs-type">buildKeyPairGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083484"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#AsymCipher"><span class="hs-identifier hs-type">AsymCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083483"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083482"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083484"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083483"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083482"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083484"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-503"></span><span id="buildKeyPairGen"><span class="annot"><span class="annottext">buildKeyPairGen :: ByteLength -&gt; g -&gt; Either GenError ((p, v), g)
</span><a href="Crypto.Classes.html#buildKeyPairGen"><span class="hs-identifier hs-var hs-var">buildKeyPairGen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(g -&gt; ByteLength -&gt; Either GenError ((p, v), g))
-&gt; ByteLength -&gt; g -&gt; Either GenError ((p, v), g)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">g -&gt; ByteLength -&gt; Either GenError ((p, v), g)
forall p v g.
(AsymCipher p v, CryptoRandomGen g) =&gt;
g -&gt; ByteLength -&gt; Either GenError ((p, v), g)
</span><a href="Crypto.Classes.html#buildKeyPair"><span class="hs-identifier hs-var">buildKeyPair</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="hs-comment">-- | A stream cipher class.  Instance are expected to work on messages as small as one byte</span><span>
</span><span id="line-506"></span><span class="hs-comment">-- The length of the resulting cipher text should be equal</span><span>
</span><span id="line-507"></span><span class="hs-comment">-- to the length of the input message.</span><span>
</span><span id="line-508"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="#local-6989586621679083886"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="StreamCipher"><span class="annot"><a href="Crypto.Classes.html#StreamCipher"><span class="hs-identifier hs-var">StreamCipher</span></a></span></span><span> </span><span id="local-6989586621679083886"><span class="annot"><a href="#local-6989586621679083886"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621679083885"><span class="annot"><a href="#local-6989586621679083885"><span class="hs-identifier hs-type">iv</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679083886"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083885"><span class="hs-identifier hs-type">iv</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-509"></span><span>  </span><span id="buildStreamKey"><span class="annot"><a href="Crypto.Classes.html#buildStreamKey"><span class="hs-identifier hs-type">buildStreamKey</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679083886"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-510"></span><span>  </span><span id="encryptStream"><span class="annot"><a href="Crypto.Classes.html#encryptStream"><span class="hs-identifier hs-type">encryptStream</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679083886"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083885"><span class="hs-identifier hs-type">iv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083885"><span class="hs-identifier hs-type">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>  </span><span id="decryptStream"><span class="annot"><a href="Crypto.Classes.html#decryptStream"><span class="hs-identifier hs-type">decryptStream</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679083886"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083885"><span class="hs-identifier hs-type">iv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083885"><span class="hs-identifier hs-type">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>  </span><span id="streamKeyLength"><span class="annot"><a href="Crypto.Classes.html#streamKeyLength"><span class="hs-identifier hs-type">streamKeyLength</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tagged</span></span><span> </span><span class="annot"><a href="#local-6989586621679083886"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="hs-comment">-- |Build a stream key using the system random generator</span><span>
</span><span id="line-515"></span><span id="local-6989586621679083475"><span id="local-6989586621679083476"><span class="annot"><a href="Crypto.Classes.html#buildStreamKeyIO"><span class="hs-identifier hs-type">buildStreamKeyIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#StreamCipher"><span class="hs-identifier hs-type">StreamCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083476"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083475"><span class="hs-identifier hs-type">iv</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679083476"><span class="hs-identifier hs-type">k</span></a></span></span></span><span>
</span><span id="line-516"></span><span id="buildStreamKeyIO"><span class="annot"><span class="annottext">buildStreamKeyIO :: IO k
</span><a href="Crypto.Classes.html#buildStreamKeyIO"><span class="hs-identifier hs-var hs-var">buildStreamKeyIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; IO ByteString) -&gt; (String -&gt; IO k) -&gt; IO k
forall (m :: * -&gt; *) k iv.
(Monad m, StreamCipher k iv) =&gt;
(ByteLength -&gt; m ByteString) -&gt; (String -&gt; m k) -&gt; m k
</span><a href="Crypto.Classes.html#buildStreamKeyM"><span class="hs-identifier hs-var">buildStreamKeyM</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; IO ByteString
</span><span class="hs-identifier hs-var">getEntropy</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO k
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span class="hs-comment">-- |Build a stream key using the provided random generator</span><span>
</span><span id="line-519"></span><span id="local-6989586621679083471"><span id="local-6989586621679083472"><span id="local-6989586621679083473"><span class="annot"><a href="Crypto.Classes.html#buildStreamKeyGen"><span class="hs-identifier hs-type">buildStreamKeyGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#StreamCipher"><span class="hs-identifier hs-type">StreamCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083473"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083472"><span class="hs-identifier hs-type">iv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083471"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083471"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083473"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083471"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-520"></span><span id="buildStreamKeyGen"><span class="annot"><span class="annottext">buildStreamKeyGen :: g -&gt; Either GenError (k, g)
</span><a href="Crypto.Classes.html#buildStreamKeyGen"><span class="hs-identifier hs-var hs-var">buildStreamKeyGen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT g (Either GenError) k -&gt; g -&gt; Either GenError (k, g)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ByteLength -&gt; StateT g (Either GenError) ByteString)
-&gt; (String -&gt; StateT g (Either GenError) k)
-&gt; StateT g (Either GenError) k
forall (m :: * -&gt; *) k iv.
(Monad m, StreamCipher k iv) =&gt;
(ByteLength -&gt; m ByteString) -&gt; (String -&gt; m k) -&gt; m k
</span><a href="Crypto.Classes.html#buildStreamKeyM"><span class="hs-identifier hs-var">buildStreamKeyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(g -&gt; Either GenError (ByteString, g))
-&gt; StateT g (Either GenError) ByteString
forall s (m :: * -&gt; *) a. (s -&gt; m (a, s)) -&gt; StateT s m a
</span><span class="hs-identifier hs-var">StateT</span></span><span> </span><span class="annot"><span class="annottext">((g -&gt; Either GenError (ByteString, g))
 -&gt; StateT g (Either GenError) ByteString)
-&gt; (ByteLength -&gt; g -&gt; Either GenError (ByteString, g))
-&gt; ByteLength
-&gt; StateT g (Either GenError) ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; g -&gt; Either GenError (ByteString, g)
forall g.
CryptoRandomGen g =&gt;
ByteLength -&gt; g -&gt; Either GenError (ByteString, g)
</span><a href="Crypto.Random.html#genBytes"><span class="hs-identifier hs-var">genBytes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either GenError k -&gt; StateT g (Either GenError) k
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Either GenError k -&gt; StateT g (Either GenError) k)
-&gt; (String -&gt; Either GenError k)
-&gt; String
-&gt; StateT g (Either GenError) k
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenError -&gt; Either GenError k
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(GenError -&gt; Either GenError k)
-&gt; (String -&gt; GenError) -&gt; String -&gt; Either GenError k
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; GenError
</span><a href="Crypto.Random.html#GenErrorOther"><span class="hs-identifier hs-var">GenErrorOther</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span id="local-6989586621679083895"><span id="local-6989586621679083896"><span id="local-6989586621679083897"><span class="annot"><a href="Crypto.Classes.html#buildStreamKeyM"><span class="hs-identifier hs-type">buildStreamKeyM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679083897"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Classes.html#StreamCipher"><span class="hs-identifier hs-type">StreamCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083896"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083895"><span class="hs-identifier hs-type">iv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083897"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083897"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083896"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083897"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083896"><span class="hs-identifier hs-type">k</span></a></span></span></span></span><span>
</span><span id="line-523"></span><span id="buildStreamKeyM"><span class="annot"><span class="annottext">buildStreamKeyM :: (ByteLength -&gt; m ByteString) -&gt; (String -&gt; m k) -&gt; m k
</span><a href="Crypto.Classes.html#buildStreamKeyM"><span class="hs-identifier hs-var hs-var">buildStreamKeyM</span></a></span></span><span> </span><span id="local-6989586621679083470"><span class="annot"><span class="annottext">getMore :: ByteLength -&gt; m ByteString
</span><a href="#local-6989586621679083470"><span class="hs-identifier hs-var">getMore</span></a></span></span><span> </span><span id="local-6989586621679083469"><span class="annot"><span class="annottext">err :: String -&gt; m k
</span><a href="#local-6989586621679083469"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; m k
forall t iv iv.
(Eq t, Num t, StreamCipher k iv, StreamCipher k iv) =&gt;
t -&gt; m k
</span><a href="#local-6989586621679083468"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-525"></span><span>  </span><span id="local-6989586621679083468"><span class="annot"><span class="annottext">go :: t -&gt; m k
</span><a href="#local-6989586621679083468"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-number">1000</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m k
</span><a href="#local-6989586621679083469"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tried 1000 times to generate a stream key from the system entropy.\
                \  No keys were returned! Perhaps the system entropy is broken\
                \ or perhaps the BlockCipher instance being used has a non-flat\
                \ keyspace.&quot;</span></span><span>
</span><span id="line-529"></span><span>  </span><span class="annot"><a href="#local-6989586621679083468"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679083467"><span class="annot"><span class="annottext">i :: t
</span><a href="#local-6989586621679083467"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083466"><span class="annot"><span class="annottext">k :: Tagged k ByteLength
</span><a href="#local-6989586621679083466"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k iv. StreamCipher k iv =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#streamKeyLength"><span class="hs-identifier hs-var">streamKeyLength</span></a></span><span>
</span><span id="line-531"></span><span>    </span><span id="local-6989586621679083465"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083465"><span class="hs-identifier hs-var">kd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; m ByteString
</span><a href="#local-6989586621679083470"><span class="hs-identifier hs-var">getMore</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; ByteLength
forall k (s :: k) b. Tagged s b -&gt; b
</span><span class="hs-identifier hs-var">untag</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
</span><a href="#local-6989586621679083466"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe k
forall k iv. StreamCipher k iv =&gt; ByteString -&gt; Maybe k
</span><a href="Crypto.Classes.html#buildStreamKey"><span class="hs-identifier hs-var">buildStreamKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083465"><span class="hs-identifier hs-var">kd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-533"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; m k
</span><a href="#local-6989586621679083468"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679083467"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679083464"><span class="annot"><span class="annottext">k' :: k
</span><a href="#local-6989586621679083464"><span class="hs-identifier hs-var">k'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">k -&gt; m k
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(k -&gt; m k) -&gt; k -&gt; m k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083464"><span class="hs-identifier hs-var">k'</span></a></span><span> </span><span class="annot"><span class="annottext">k -&gt; Tagged k ByteLength -&gt; k
forall k s (tagged :: * -&gt; k -&gt; *) (b :: k). s -&gt; tagged s b -&gt; s
</span><span class="hs-operator hs-var">`asTaggedTypeOf`</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
</span><a href="#local-6989586621679083466"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span class="hs-comment">-- | A class for signing operations which inherently can not be as generic</span><span>
</span><span id="line-537"></span><span class="hs-comment">-- as asymetric ciphers (ex: DSA).</span><span>
</span><span id="line-538"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="#local-6989586621679083882"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="#local-6989586621679083881"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="Signing"><span class="annot"><a href="Crypto.Classes.html#Signing"><span class="hs-identifier hs-var">Signing</span></a></span></span><span> </span><span id="local-6989586621679083882"><span class="annot"><a href="#local-6989586621679083882"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621679083881"><span class="annot"><a href="#local-6989586621679083881"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679083882"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083881"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083881"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083882"><span class="hs-identifier hs-type">p</span></a></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-539"></span><span>  </span><span id="local-6989586621679083463"><span id="sign"><span class="annot"><a href="Crypto.Classes.html#sign"><span class="hs-identifier hs-type">sign</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083463"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083463"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083881"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083463"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-540"></span><span>  </span><span id="verify"><span class="annot"><a href="Crypto.Classes.html#verify"><span class="hs-identifier hs-type">verify</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679083882"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-541"></span><span>  </span><span id="local-6989586621679083879"><span id="buildSigningPair"><span class="annot"><a href="Crypto.Classes.html#buildSigningPair"><span class="hs-identifier hs-type">buildSigningPair</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083879"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083879"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083882"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083881"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083879"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-542"></span><span>  </span><span id="signingKeyLength"><span class="annot"><a href="Crypto.Classes.html#signingKeyLength"><span class="hs-identifier hs-type">signingKeyLength</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679083881"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span>
</span><span id="line-543"></span><span>  </span><span id="verifyingKeyLength"><span class="annot"><a href="Crypto.Classes.html#verifyingKeyLength"><span class="hs-identifier hs-type">verifyingKeyLength</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679083882"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="hs-comment">-- |Build a signing key using the system random generator</span><span>
</span><span id="line-546"></span><span class="hs-comment">--   WARNING: This function opens a file handle which will never be closed!</span><span>
</span><span id="line-547"></span><span id="local-6989586621679083456"><span id="local-6989586621679083457"><span class="annot"><a href="Crypto.Classes.html#buildSigningKeyPairIO"><span class="hs-identifier hs-type">buildSigningKeyPairIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#Signing"><span class="hs-identifier hs-type">Signing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083457"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083456"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083457"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083456"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-548"></span><span id="buildSigningKeyPairIO"><span class="annot"><span class="annottext">buildSigningKeyPairIO :: ByteLength -&gt; IO (Either GenError (p, v))
</span><a href="Crypto.Classes.html#buildSigningKeyPairIO"><span class="hs-identifier hs-var hs-var">buildSigningKeyPairIO</span></a></span></span><span> </span><span id="local-6989586621679083455"><span class="annot"><span class="annottext">bl :: ByteLength
</span><a href="#local-6989586621679083455"><span class="hs-identifier hs-var">bl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>        </span><span id="local-6989586621679083454"><span class="annot"><span class="annottext">SystemRandom
</span><a href="#local-6989586621679083454"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SystemRandom
forall g. CryptoRandomGen g =&gt; IO g
</span><a href="Crypto.Random.html#newGenIO"><span class="hs-identifier hs-var">newGenIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#SystemRandom"><span class="hs-identifier hs-type">SystemRandom</span></a></span><span>
</span><span id="line-550"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SystemRandom
-&gt; ByteLength -&gt; Either GenError ((p, v), SystemRandom)
forall p v g.
(Signing p v, CryptoRandomGen g) =&gt;
g -&gt; ByteLength -&gt; Either GenError ((p, v), g)
</span><a href="Crypto.Classes.html#buildSigningPair"><span class="hs-identifier hs-var">buildSigningPair</span></a></span><span> </span><span class="annot"><span class="annottext">SystemRandom
</span><a href="#local-6989586621679083454"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083455"><span class="hs-identifier hs-var">bl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-551"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679083453"><span class="annot"><span class="annottext">err :: GenError
</span><a href="#local-6989586621679083453"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either GenError (p, v) -&gt; IO (Either GenError (p, v))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either GenError (p, v) -&gt; IO (Either GenError (p, v)))
-&gt; Either GenError (p, v) -&gt; IO (Either GenError (p, v))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GenError -&gt; Either GenError (p, v)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">GenError
</span><a href="#local-6989586621679083453"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-552"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083452"><span class="annot"><span class="annottext">k :: (p, v)
</span><a href="#local-6989586621679083452"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either GenError (p, v) -&gt; IO (Either GenError (p, v))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either GenError (p, v) -&gt; IO (Either GenError (p, v)))
-&gt; Either GenError (p, v) -&gt; IO (Either GenError (p, v))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(p, v) -&gt; Either GenError (p, v)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(p, v)
</span><a href="#local-6989586621679083452"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="hs-comment">-- |Flipped 'buildSigningPair' for ease of use with state monads.</span><span>
</span><span id="line-555"></span><span id="local-6989586621679083449"><span id="local-6989586621679083450"><span id="local-6989586621679083451"><span class="annot"><a href="Crypto.Classes.html#buildSigningKeyPairGen"><span class="hs-identifier hs-type">buildSigningKeyPairGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#Signing"><span class="hs-identifier hs-type">Signing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083451"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083450"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083449"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083449"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083451"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083450"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083449"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-556"></span><span id="buildSigningKeyPairGen"><span class="annot"><span class="annottext">buildSigningKeyPairGen :: ByteLength -&gt; g -&gt; Either GenError ((p, v), g)
</span><a href="Crypto.Classes.html#buildSigningKeyPairGen"><span class="hs-identifier hs-var hs-var">buildSigningKeyPairGen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(g -&gt; ByteLength -&gt; Either GenError ((p, v), g))
-&gt; ByteLength -&gt; g -&gt; Either GenError ((p, v), g)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">g -&gt; ByteLength -&gt; Either GenError ((p, v), g)
forall p v g.
(Signing p v, CryptoRandomGen g) =&gt;
g -&gt; ByteLength -&gt; Either GenError ((p, v), g)
</span><a href="Crypto.Classes.html#buildSigningPair"><span class="hs-identifier hs-var">buildSigningPair</span></a></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="hs-comment">-- | Like `ecb` but for strict bytestrings</span><span>
</span><span id="line-559"></span><span id="local-6989586621679084028"><span class="annot"><a href="Crypto.Classes.html#modeEcb%27"><span class="hs-identifier hs-type">modeEcb'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084028"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084028"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span></span><span>
</span><span id="line-560"></span><span id="modeEcb%27"><span class="annot"><span class="annottext">modeEcb' :: k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#modeEcb%27"><span class="hs-identifier hs-var hs-var">modeEcb'</span></a></span></span><span> </span><span id="local-6989586621679083448"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083448"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679083447"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083447"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-561"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083446"><span class="annot"><span class="annottext">chunks :: [ByteString]
</span><a href="#local-6989586621679083446"><span class="hs-identifier hs-var hs-var">chunks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083448"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083447"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-562"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; [ByteString] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083448"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083446"><span class="hs-identifier hs-var">chunks</span></a></span><span>
</span><span id="line-563"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeEcb%27"><span class="hs-pragma hs-type">modeEcb'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span class="hs-comment">-- |Decryption complement to `ecb'`</span><span>
</span><span id="line-566"></span><span id="local-6989586621679083445"><span class="annot"><a href="Crypto.Classes.html#modeUnEcb%27"><span class="hs-identifier hs-type">modeUnEcb'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083445"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083445"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span></span><span>
</span><span id="line-567"></span><span id="modeUnEcb%27"><span class="annot"><span class="annottext">modeUnEcb' :: k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#modeUnEcb%27"><span class="hs-identifier hs-var hs-var">modeUnEcb'</span></a></span></span><span> </span><span id="local-6989586621679083444"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083444"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679083443"><span class="annot"><span class="annottext">ct :: ByteString
</span><a href="#local-6989586621679083443"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083442"><span class="annot"><span class="annottext">chunks :: [ByteString]
</span><a href="#local-6989586621679083442"><span class="hs-identifier hs-var hs-var">chunks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083444"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083443"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-569"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; [ByteString] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#decryptBlock"><span class="hs-identifier hs-var">decryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083444"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083442"><span class="hs-identifier hs-var">chunks</span></a></span><span>
</span><span id="line-570"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeUnEcb%27"><span class="hs-pragma hs-type">modeUnEcb'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span class="hs-comment">-- |Cipher block chaining encryption mode on strict bytestrings</span><span>
</span><span id="line-573"></span><span id="local-6989586621679084025"><span class="annot"><a href="Crypto.Classes.html#modeCbc%27"><span class="hs-identifier hs-type">modeCbc'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084025"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084025"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084025"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084025"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-574"></span><span id="modeCbc%27"><span class="annot"><span class="annottext">modeCbc' :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCbc%27"><span class="hs-identifier hs-var hs-var">modeCbc'</span></a></span></span><span> </span><span id="local-6989586621679083441"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083441"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083440"><span class="annot"><span class="annottext">v :: ByteString
</span><a href="#local-6989586621679083440"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083439"><span class="annot"><span class="annottext">plaintext :: ByteString
</span><a href="#local-6989586621679083439"><span class="hs-identifier hs-var">plaintext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-575"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083438"><span class="annot"><span class="annottext">blks :: [ByteString]
</span><a href="#local-6989586621679083438"><span class="hs-identifier hs-var hs-var">blks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083441"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083439"><span class="hs-identifier hs-var">plaintext</span></a></span><span>
</span><span id="line-576"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083437"><span class="annot"><span class="annottext">cts :: [ByteString]
</span><a href="#local-6989586621679083437"><span class="hs-identifier hs-var">cts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083436"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083436"><span class="hs-identifier hs-var">iv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083435"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083438"><span class="hs-identifier hs-var">blks</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083440"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-577"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083437"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083436"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-579"></span><span>  </span><span id="local-6989586621679083435"><span class="annot"><span class="annottext">go :: [ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083435"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679083434"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083434"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083434"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>  </span><span class="annot"><a href="#local-6989586621679083435"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083433"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621679083433"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083432"><span class="annot"><span class="annottext">bs :: [ByteString]
</span><a href="#local-6989586621679083432"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083431"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083431"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-581"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083430"><span class="annot"><span class="annottext">c :: ByteString
</span><a href="#local-6989586621679083430"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083441"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083431"><span class="hs-identifier hs-var">iv</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083433"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083429"><span class="annot"><span class="annottext">cs :: [ByteString]
</span><a href="#local-6989586621679083429"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083428"><span class="annot"><span class="annottext">ivFinal :: ByteString
</span><a href="#local-6989586621679083428"><span class="hs-identifier hs-var">ivFinal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083435"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083432"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083430"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-583"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083430"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083429"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083428"><span class="hs-identifier hs-var">ivFinal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeCbc%27"><span class="hs-pragma hs-type">modeCbc'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span class="hs-comment">-- |Cipher block chaining decryption for strict bytestrings</span><span>
</span><span id="line-587"></span><span id="local-6989586621679083427"><span class="annot"><a href="Crypto.Classes.html#modeUnCbc%27"><span class="hs-identifier hs-type">modeUnCbc'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083427"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083427"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083427"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083427"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-588"></span><span id="modeUnCbc%27"><span class="annot"><span class="annottext">modeUnCbc' :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCbc%27"><span class="hs-identifier hs-var hs-var">modeUnCbc'</span></a></span></span><span> </span><span id="local-6989586621679083426"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083426"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083425"><span class="annot"><span class="annottext">v :: ByteString
</span><a href="#local-6989586621679083425"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083424"><span class="annot"><span class="annottext">ciphertext :: ByteString
</span><a href="#local-6989586621679083424"><span class="hs-identifier hs-var">ciphertext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-589"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083423"><span class="annot"><span class="annottext">blks :: [ByteString]
</span><a href="#local-6989586621679083423"><span class="hs-identifier hs-var hs-var">blks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083426"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083424"><span class="hs-identifier hs-var">ciphertext</span></a></span><span>
</span><span id="line-590"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083422"><span class="annot"><span class="annottext">pts :: [ByteString]
</span><a href="#local-6989586621679083422"><span class="hs-identifier hs-var">pts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083421"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083421"><span class="hs-identifier hs-var">iv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083420"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083423"><span class="hs-identifier hs-var">blks</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083425"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-591"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083422"><span class="hs-identifier hs-var">pts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083421"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-593"></span><span>  </span><span id="local-6989586621679083420"><span class="annot"><span class="annottext">go :: [ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083420"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679083419"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083419"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083419"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-594"></span><span>  </span><span class="annot"><a href="#local-6989586621679083420"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083418"><span class="annot"><span class="annottext">c :: ByteString
</span><a href="#local-6989586621679083418"><span class="hs-identifier hs-var">c</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083417"><span class="annot"><span class="annottext">cs :: [ByteString]
</span><a href="#local-6989586621679083417"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083416"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083416"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-595"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083415"><span class="annot"><span class="annottext">p :: ByteString
</span><a href="#local-6989586621679083415"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#decryptBlock"><span class="hs-identifier hs-var">decryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083426"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083418"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083416"><span class="hs-identifier hs-var">iv</span></a></span><span>
</span><span id="line-596"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083414"><span class="annot"><span class="annottext">ps :: [ByteString]
</span><a href="#local-6989586621679083414"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083413"><span class="annot"><span class="annottext">ivFinal :: ByteString
</span><a href="#local-6989586621679083413"><span class="hs-identifier hs-var">ivFinal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083420"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083417"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083418"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083415"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083414"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083413"><span class="hs-identifier hs-var">ivFinal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeUnCbc%27"><span class="hs-pragma hs-type">modeUnCbc'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span class="hs-comment">-- |Output feedback mode for strict bytestrings</span><span>
</span><span id="line-601"></span><span id="local-6989586621679083412"><span class="annot"><a href="Crypto.Classes.html#modeOfb%27"><span class="hs-identifier hs-type">modeOfb'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083412"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083412"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083412"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083412"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-602"></span><span id="modeOfb%27"><span class="annot"><span class="annottext">modeOfb' :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeOfb%27"><span class="hs-identifier hs-var hs-var">modeOfb'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnOfb%27"><span class="hs-identifier hs-var">modeUnOfb'</span></a></span><span>
</span><span id="line-603"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeOfb%27"><span class="hs-pragma hs-type">modeOfb'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span class="hs-comment">-- |Output feedback mode for strict bytestrings</span><span>
</span><span id="line-606"></span><span id="local-6989586621679083411"><span class="annot"><a href="Crypto.Classes.html#modeUnOfb%27"><span class="hs-identifier hs-type">modeUnOfb'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083411"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083411"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083411"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083411"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-607"></span><span id="modeUnOfb%27"><span class="annot"><span class="annottext">modeUnOfb' :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnOfb%27"><span class="hs-identifier hs-var hs-var">modeUnOfb'</span></a></span></span><span> </span><span id="local-6989586621679083410"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083410"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083409"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083409"><span class="hs-identifier hs-var">iv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083408"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083408"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-608"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083407"><span class="annot"><span class="annottext">ivStr :: [ByteString]
</span><a href="#local-6989586621679083407"><span class="hs-identifier hs-var hs-var">ivStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; [ByteString] -&gt; [ByteString]
</span><a href="Crypto.Util.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083408"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083405"><span class="hs-identifier hs-var">ivLen</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteLength -&gt; [ByteString] -&gt; [ByteString]
forall a. ByteLength -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; [ByteString]
forall a. (a -&gt; a) -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">iterate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083410"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083409"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span>            </span><span id="local-6989586621679083405"><span class="annot"><span class="annottext">ivLen :: ByteLength
</span><a href="#local-6989586621679083405"><span class="hs-identifier hs-var hs-var">ivLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083409"><span class="hs-identifier hs-var">iv</span></a></span><span>
</span><span id="line-610"></span><span>            </span><span id="local-6989586621679083404"><span class="annot"><span class="annottext">mLen :: Int64
</span><a href="#local-6989586621679083404"><span class="hs-identifier hs-var hs-var">mLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083408"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>            </span><span id="local-6989586621679083403"><span class="annot"><span class="annottext">newIV :: IV k
</span><a href="#local-6989586621679083403"><span class="hs-identifier hs-var hs-var">newIV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k)
-&gt; ([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; IV k
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString)
-&gt; ([ByteString] -&gt; [ByteString]) -&gt; [ByteString] -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">L.toChunks</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; [ByteString])
-&gt; ([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; [ByteString]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">L.take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteLength -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083405"><span class="hs-identifier hs-var">ivLen</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; ([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">L.drop</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679083404"><span class="hs-identifier hs-var">mLen</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; ([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">L.fromChunks</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; IV k) -&gt; [ByteString] -&gt; IV k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083407"><span class="hs-identifier hs-var">ivStr</span></a></span><span>
</span><span id="line-612"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083407"><span class="hs-identifier hs-var">ivStr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083408"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IV k
forall k. IV k
</span><a href="#local-6989586621679083403"><span class="hs-identifier hs-var">newIV</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeUnOfb%27"><span class="hs-pragma hs-type">modeUnOfb'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span class="hs-comment">-- |Counter mode for strict bytestrings</span><span>
</span><span id="line-616"></span><span id="local-6989586621679084024"><span class="annot"><a href="Crypto.Classes.html#modeCtr%27"><span class="hs-identifier hs-type">modeCtr'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084024"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084024"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084024"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084024"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084024"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084024"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-617"></span><span id="modeCtr%27"><span class="annot"><span class="annottext">modeCtr' :: (IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCtr%27"><span class="hs-identifier hs-var hs-var">modeCtr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
forall k.
BlockCipher k =&gt;
(IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCtr%27"><span class="hs-identifier hs-var">modeUnCtr'</span></a></span><span>
</span><span id="line-618"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeCtr%27"><span class="hs-pragma hs-type">modeCtr'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span class="hs-comment">-- |Counter mode for strict bytestrings</span><span>
</span><span id="line-621"></span><span id="local-6989586621679083402"><span class="annot"><a href="Crypto.Classes.html#modeUnCtr%27"><span class="hs-identifier hs-type">modeUnCtr'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083402"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083402"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083402"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083402"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083402"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083402"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-622"></span><span id="modeUnCtr%27"><span class="annot"><span class="annottext">modeUnCtr' :: (IV k -&gt; IV k) -&gt; k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCtr%27"><span class="hs-identifier hs-var hs-var">modeUnCtr'</span></a></span></span><span> </span><span id="local-6989586621679083401"><span class="annot"><span class="annottext">f :: IV k -&gt; IV k
</span><a href="#local-6989586621679083401"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679083400"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083400"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679083399"><span class="annot"><span class="annottext">iv :: IV k
</span><a href="#local-6989586621679083399"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span id="local-6989586621679083398"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083398"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-623"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083397"><span class="annot"><span class="annottext">fa :: (ByteString, IV k) -&gt; Word8 -&gt; ((ByteString, IV k), Word8)
</span><a href="#local-6989586621679083397"><span class="hs-identifier hs-var hs-var">fa</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083396"><span class="annot"><span class="annottext">st :: ByteString
</span><a href="#local-6989586621679083396"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083395"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083395"><span class="hs-identifier hs-var">iv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083394"><span class="annot"><span class="annottext">c :: Word8
</span><a href="#local-6989586621679083394"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span>
</span><span id="line-624"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">B.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083396"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString, IV k) -&gt; Word8 -&gt; ((ByteString, IV k), Word8)
</span><a href="#local-6989586621679083397"><span class="hs-identifier hs-var">fa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083400"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083395"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IV k -&gt; IV k
</span><a href="#local-6989586621679083401"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083395"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679083394"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-625"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083392"><span class="annot"><span class="annottext">s :: Word8
</span><a href="#local-6989586621679083392"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083391"><span class="annot"><span class="annottext">nst :: ByteString
</span><a href="#local-6989586621679083391"><span class="hs-identifier hs-var">nst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Word8, ByteString)
</span><span class="hs-identifier hs-var">B.uncons</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083396"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083391"><span class="hs-identifier hs-var">nst</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083395"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">xor</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679083394"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679083392"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>           </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span id="local-6989586621679083388"><span class="annot"><span class="annottext">newIV :: IV k
</span><a href="#local-6989586621679083388"><span class="hs-identifier hs-var">newIV</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679083387"><span class="annot"><span class="annottext">res :: ByteString
</span><a href="#local-6989586621679083387"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ByteString, IV k) -&gt; Word8 -&gt; ((ByteString, IV k), Word8))
-&gt; (ByteString, IV k)
-&gt; ByteString
-&gt; ((ByteString, IV k), ByteString)
forall acc.
(acc -&gt; Word8 -&gt; (acc, Word8))
-&gt; acc -&gt; ByteString -&gt; (acc, ByteString)
</span><span class="hs-identifier hs-var">B.mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">(ByteString, IV k) -&gt; Word8 -&gt; ((ByteString, IV k), Word8)
forall k.
(ByteString, IV k) -&gt; Word8 -&gt; ((ByteString, IV k), Word8)
</span><a href="#local-6989586621679083397"><span class="hs-identifier hs-var">fa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">B.empty</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083399"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083398"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span>
</span><span id="line-627"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083387"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083388"><span class="hs-identifier hs-var">newIV</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeUnCtr%27"><span class="hs-pragma hs-type">modeUnCtr'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span class="hs-comment">-- |Ciphertext feed-back encryption mode for strict bytestrings (with</span><span>
</span><span id="line-631"></span><span class="hs-comment">-- s == blockSize)</span><span>
</span><span id="line-632"></span><span id="local-6989586621679083385"><span class="annot"><a href="Crypto.Classes.html#modeCfb%27"><span class="hs-identifier hs-type">modeCfb'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083385"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083385"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083385"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083385"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-633"></span><span id="modeCfb%27"><span class="annot"><span class="annottext">modeCfb' :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeCfb%27"><span class="hs-identifier hs-var hs-var">modeCfb'</span></a></span></span><span> </span><span id="local-6989586621679083384"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083384"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083383"><span class="annot"><span class="annottext">v :: ByteString
</span><a href="#local-6989586621679083383"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083382"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083382"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-634"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083381"><span class="annot"><span class="annottext">blks :: [ByteString]
</span><a href="#local-6989586621679083381"><span class="hs-identifier hs-var hs-var">blks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083384"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083382"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-635"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083380"><span class="annot"><span class="annottext">cs :: [ByteString]
</span><a href="#local-6989586621679083380"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083379"><span class="annot"><span class="annottext">ivF :: ByteString
</span><a href="#local-6989586621679083379"><span class="hs-identifier hs-var">ivF</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083378"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083383"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083381"><span class="hs-identifier hs-var">blks</span></a></span><span>
</span><span id="line-636"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083380"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083379"><span class="hs-identifier hs-var">ivF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-638"></span><span>  </span><span id="local-6989586621679083378"><span class="annot"><span class="annottext">go :: ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083378"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679083377"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083377"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083377"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>  </span><span class="annot"><a href="#local-6989586621679083378"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679083376"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083376"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083375"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621679083375"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083374"><span class="annot"><span class="annottext">bs :: [ByteString]
</span><a href="#local-6989586621679083374"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-640"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083373"><span class="annot"><span class="annottext">c :: ByteString
</span><a href="#local-6989586621679083373"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083384"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083376"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083375"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-641"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083372"><span class="annot"><span class="annottext">cs :: [ByteString]
</span><a href="#local-6989586621679083372"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083371"><span class="annot"><span class="annottext">ivFinal :: ByteString
</span><a href="#local-6989586621679083371"><span class="hs-identifier hs-var">ivFinal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083378"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083373"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083374"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-642"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083373"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083372"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083371"><span class="hs-identifier hs-var">ivFinal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeCfb%27"><span class="hs-pragma hs-type">modeCfb'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span class="hs-comment">-- |Ciphertext feed-back decryption mode for strict bytestrings (with s == blockSize)</span><span>
</span><span id="line-646"></span><span id="local-6989586621679083370"><span class="annot"><a href="Crypto.Classes.html#modeUnCfb%27"><span class="hs-identifier hs-type">modeUnCfb'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083370"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083370"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083370"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083370"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-647"></span><span id="modeUnCfb%27"><span class="annot"><span class="annottext">modeUnCfb' :: k -&gt; IV k -&gt; ByteString -&gt; (ByteString, IV k)
</span><a href="Crypto.Classes.html#modeUnCfb%27"><span class="hs-identifier hs-var hs-var">modeUnCfb'</span></a></span></span><span> </span><span id="local-6989586621679083369"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083369"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083368"><span class="annot"><span class="annottext">v :: ByteString
</span><a href="#local-6989586621679083368"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083367"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679083367"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-648"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083366"><span class="annot"><span class="annottext">blks :: [ByteString]
</span><a href="#local-6989586621679083366"><span class="hs-identifier hs-var hs-var">blks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; [ByteString]
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083369"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083367"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-649"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083365"><span class="annot"><span class="annottext">ps :: [ByteString]
</span><a href="#local-6989586621679083365"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083364"><span class="annot"><span class="annottext">ivF :: ByteString
</span><a href="#local-6989586621679083364"><span class="hs-identifier hs-var">ivF</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083363"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083368"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083366"><span class="hs-identifier hs-var">blks</span></a></span><span>
</span><span id="line-650"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083365"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083364"><span class="hs-identifier hs-var">ivF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-651"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-652"></span><span>  </span><span id="local-6989586621679083363"><span class="annot"><span class="annottext">go :: ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083363"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679083362"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083362"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083362"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>  </span><span class="annot"><a href="#local-6989586621679083363"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679083361"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083361"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083360"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621679083360"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083359"><span class="annot"><span class="annottext">bs :: [ByteString]
</span><a href="#local-6989586621679083359"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-654"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083358"><span class="annot"><span class="annottext">p :: ByteString
</span><a href="#local-6989586621679083358"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; ByteString -&gt; ByteString
forall k. BlockCipher k =&gt; k -&gt; ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083369"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083361"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083360"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-655"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679083357"><span class="annot"><span class="annottext">ps :: [ByteString]
</span><a href="#local-6989586621679083357"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083356"><span class="annot"><span class="annottext">ivF :: ByteString
</span><a href="#local-6989586621679083356"><span class="hs-identifier hs-var">ivF</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ([ByteString], ByteString)
</span><a href="#local-6989586621679083363"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083360"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083359"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-656"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083358"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083357"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083356"><span class="hs-identifier hs-var">ivF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#modeUnCfb%27"><span class="hs-pragma hs-type">modeUnCfb'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span class="annot"><a href="Crypto.Classes.html#toChunks"><span class="hs-identifier hs-type">toChunks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">]</span><span>
</span><span id="line-660"></span><span id="toChunks"><span class="annot"><span class="annottext">toChunks :: ByteLength -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#toChunks"><span class="hs-identifier hs-var hs-var">toChunks</span></a></span></span><span> </span><span id="local-6989586621679083354"><span class="annot"><span class="annottext">n :: ByteLength
</span><a href="#local-6989586621679083354"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679083353"><span class="annot"><span class="annottext">val :: ByteString
</span><a href="#local-6989586621679083353"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="#local-6989586621679083352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083353"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-661"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-662"></span><span>  </span><span id="local-6989586621679083352"><span class="annot"><span class="annottext">go :: ByteString -&gt; [ByteString]
</span><a href="#local-6989586621679083352"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679083351"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621679083351"><span class="hs-identifier hs-var">b</span></a></span></span><span>
</span><span id="line-663"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083351"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-664"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083350"><span class="annot"><span class="annottext">h :: ByteString
</span><a href="#local-6989586621679083350"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083349"><span class="annot"><span class="annottext">t :: ByteString
</span><a href="#local-6989586621679083349"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">B.splitAt</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083354"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083351"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-665"></span><span>                        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083350"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="#local-6989586621679083352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083349"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span class="hs-comment">-- |Increase an `IV` by one.  This is way faster than decoding,</span><span>
</span><span id="line-668"></span><span class="hs-comment">-- increasing, encoding</span><span>
</span><span id="line-669"></span><span id="local-6989586621679084023"><span class="annot"><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-type">incIV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084023"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084023"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084023"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-670"></span><span id="incIV"><span class="annot"><span class="annottext">incIV :: IV k -&gt; IV k
</span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var hs-var">incIV</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083348"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621679083348"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k) -&gt; ByteString -&gt; IV k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Word16, ByteString) -&gt; ByteString
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Word16, ByteString) -&gt; ByteString)
-&gt; (Word16, ByteString) -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Word8 -&gt; (Word16, Word8))
-&gt; Word16 -&gt; ByteString -&gt; (Word16, ByteString)
forall acc.
(acc -&gt; Word8 -&gt; (acc, Word8))
-&gt; acc -&gt; ByteString -&gt; (acc, ByteString)
</span><span class="hs-identifier hs-var">B.mapAccumR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word8 -&gt; (Word16, Word8)
</span><a href="#local-6989586621679083346"><span class="hs-identifier hs-var">incw</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083348"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-672"></span><span>       </span><span class="annot"><a href="#local-6989586621679083346"><span class="hs-identifier hs-type">incw</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>       </span><span id="local-6989586621679083346"><span class="annot"><span class="annottext">incw :: Word16 -&gt; Word8 -&gt; (Word16, Word8)
</span><a href="#local-6989586621679083346"><span class="hs-identifier hs-var hs-var">incw</span></a></span></span><span> </span><span id="local-6989586621679083345"><span class="annot"><span class="annottext">i :: Word16
</span><a href="#local-6989586621679083345"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679083344"><span class="annot"><span class="annottext">w :: Word8
</span><a href="#local-6989586621679083344"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083343"><span class="annot"><span class="annottext">nw :: Word16
</span><a href="#local-6989586621679083343"><span class="hs-identifier hs-var hs-var">nw</span></a></span></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679083345"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Word16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679083344"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; ByteLength -&gt; Word16
forall a. Bits a =&gt; a -&gt; ByteLength -&gt; a
</span><span class="hs-identifier hs-var">shiftR</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679083343"><span class="hs-identifier hs-var">nw</span></a></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679083343"><span class="hs-identifier hs-var">nw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span class="hs-comment">-- |Obtain an `IV` made only of zeroes</span><span>
</span><span id="line-676"></span><span id="local-6989586621679083341"><span class="annot"><a href="Crypto.Classes.html#zeroIV"><span class="hs-identifier hs-type">zeroIV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083341"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083341"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-677"></span><span id="zeroIV"><span class="annot"><span class="annottext">zeroIV :: IV k
</span><a href="Crypto.Classes.html#zeroIV"><span class="hs-identifier hs-var hs-var">zeroIV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083340"><span class="hs-identifier hs-var">iv</span></a></span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679083339"><span class="annot"><span class="annottext">bytes :: ByteLength
</span><a href="#local-6989586621679083339"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IV k -&gt; ByteLength
forall k. BlockCipher k =&gt; IV k -&gt; ByteLength
</span><a href="Crypto.Classes.html#ivBlockSizeBytes"><span class="hs-identifier hs-var">ivBlockSizeBytes</span></a></span><span> </span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083340"><span class="hs-identifier hs-var">iv</span></a></span><span>
</span><span id="line-679"></span><span>        </span><span id="local-6989586621679083340"><span class="annot"><span class="annottext">iv :: IV k
</span><a href="#local-6989586621679083340"><span class="hs-identifier hs-var hs-var">iv</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k) -&gt; ByteString -&gt; IV k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">B.replicate</span></span><span>  </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083339"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span id="local-6989586621679083337"><span class="annot"><a href="Crypto.Classes.html#zeroIVcwc"><span class="hs-identifier hs-type">zeroIVcwc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083337"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083337"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-682"></span><span id="zeroIVcwc"><span class="annot"><span class="annottext">zeroIVcwc :: IV k
</span><a href="Crypto.Classes.html#zeroIVcwc"><span class="hs-identifier hs-var hs-var">zeroIVcwc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083335"><span class="hs-identifier hs-var">iv</span></a></span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679083334"><span class="annot"><span class="annottext">bytes :: ByteLength
</span><a href="#local-6989586621679083334"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IV k -&gt; ByteLength
forall k. BlockCipher k =&gt; IV k -&gt; ByteLength
</span><a href="Crypto.Classes.html#ivBlockSizeBytes"><span class="hs-identifier hs-var">ivBlockSizeBytes</span></a></span><span> </span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083335"><span class="hs-identifier hs-var">iv</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span>  </span><span class="hs-comment">-- a constant of cwc (4 bytes for ctr mode, 1 for a sort of header on the iv)</span><span>
</span><span id="line-684"></span><span>        </span><span id="local-6989586621679083335"><span class="annot"><span class="annottext">iv :: IV k
</span><a href="#local-6989586621679083335"><span class="hs-identifier hs-var hs-var">iv</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k) -&gt; ByteString -&gt; IV k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">B.replicate</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083334"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span class="hs-comment">-- Break a bytestring into block size chunks.</span><span>
</span><span id="line-687"></span><span id="local-6989586621679084002"><span class="annot"><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-type">chunkFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679084002"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679084002"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-688"></span><span id="chunkFor"><span class="annot"><span class="annottext">chunkFor :: k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var hs-var">chunkFor</span></a></span></span><span> </span><span id="local-6989586621679083333"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083333"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="#local-6989586621679083332"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-689"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-690"></span><span>  </span><span id="local-6989586621679083331"><span class="annot"><span class="annottext">blkSz :: ByteLength
</span><a href="#local-6989586621679083331"><span class="hs-identifier hs-var hs-var">blkSz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; k -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#for"><span class="hs-operator hs-var">`for`</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083333"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span>
</span><span id="line-691"></span><span>  </span><span id="local-6989586621679083330"><span class="annot"><span class="annottext">blkSzI :: Int64
</span><a href="#local-6989586621679083330"><span class="hs-identifier hs-var hs-var">blkSzI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083331"><span class="hs-identifier hs-var">blkSz</span></a></span><span>
</span><span id="line-692"></span><span>  </span><span id="local-6989586621679083332"><span class="annot"><span class="annottext">go :: ByteString -&gt; [ByteString]
</span><a href="#local-6989586621679083332"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679083329"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679083329"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><span class="hs-identifier hs-var">L.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083329"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679083330"><span class="hs-identifier hs-var">blkSzI</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-693"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083328"><span class="annot"><span class="annottext">blk :: ByteString
</span><a href="#local-6989586621679083328"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083327"><span class="annot"><span class="annottext">rest :: ByteString
</span><a href="#local-6989586621679083327"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">L.splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679083330"><span class="hs-identifier hs-var">blkSzI</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083329"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">L.toChunks</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083328"><span class="hs-identifier hs-var">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="#local-6989586621679083332"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083327"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-694"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#chunkFor"><span class="hs-pragma hs-type">chunkFor</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="hs-comment">-- Break a bytestring into block size chunks.</span><span>
</span><span id="line-697"></span><span id="local-6989586621679083874"><span class="annot"><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-type">chunkFor'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083874"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083874"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-698"></span><span id="chunkFor%27"><span class="annot"><span class="annottext">chunkFor' :: k -&gt; ByteString -&gt; [ByteString]
</span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var hs-var">chunkFor'</span></a></span></span><span> </span><span id="local-6989586621679083326"><span class="annot"><span class="annottext">k :: k
</span><a href="#local-6989586621679083326"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="#local-6989586621679083325"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-700"></span><span>  </span><span id="local-6989586621679083324"><span class="annot"><span class="annottext">blkSz :: ByteLength
</span><a href="#local-6989586621679083324"><span class="hs-identifier hs-var hs-var">blkSz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; k -&gt; ByteLength
forall a b. Tagged a b -&gt; a -&gt; b
</span><a href="Crypto.Util.html#for"><span class="hs-operator hs-var">`for`</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679083326"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span>
</span><span id="line-701"></span><span>  </span><span id="local-6989586621679083325"><span class="annot"><span class="annottext">go :: ByteString -&gt; [ByteString]
</span><a href="#local-6989586621679083325"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679083323"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679083323"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteLength
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083323"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083324"><span class="hs-identifier hs-var">blkSz</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-702"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083322"><span class="annot"><span class="annottext">blk :: ByteString
</span><a href="#local-6989586621679083322"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083321"><span class="annot"><span class="annottext">rest :: ByteString
</span><a href="#local-6989586621679083321"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">B.splitAt</span></span><span> </span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083324"><span class="hs-identifier hs-var">blkSz</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083323"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083322"><span class="hs-identifier hs-var">blk</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="#local-6989586621679083325"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083321"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-703"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-pragma hs-type">chunkFor'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span class="hs-comment">-- |Create the mask for SIV based ciphers</span><span>
</span><span id="line-706"></span><span class="annot"><a href="Crypto.Classes.html#sivMask"><span class="hs-identifier hs-type">sivMask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-707"></span><span id="sivMask"><span class="annot"><span class="annottext">sivMask :: ByteString -&gt; ByteString
</span><a href="Crypto.Classes.html#sivMask"><span class="hs-identifier hs-var hs-var">sivMask</span></a></span></span><span> </span><span id="local-6989586621679083320"><span class="annot"><span class="annottext">b :: ByteString
</span><a href="#local-6989586621679083320"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteLength, ByteString) -&gt; ByteString
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((ByteLength, ByteString) -&gt; ByteString)
-&gt; (ByteLength, ByteString) -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteLength -&gt; Word8 -&gt; (ByteLength, Word8))
-&gt; ByteLength -&gt; ByteString -&gt; (ByteLength, ByteString)
forall acc.
(acc -&gt; Word8 -&gt; (acc, Word8))
-&gt; acc -&gt; ByteString -&gt; (acc, ByteString)
</span><span class="hs-identifier hs-var">B.mapAccumR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteLength -&gt; Word8 -&gt; (ByteLength, Word8)
</span><a href="#local-6989586621679083319"><span class="hs-identifier hs-var">go</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083320"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-708"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-709"></span><span>       </span><span class="annot"><a href="#local-6989586621679083319"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>       </span><span id="local-6989586621679083319"><span class="annot"><span class="annottext">go :: ByteLength -&gt; Word8 -&gt; (ByteLength, Word8)
</span><a href="#local-6989586621679083319"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-number">24</span><span> </span><span id="local-6989586621679083318"><span class="annot"><span class="annottext">w :: Word8
</span><a href="#local-6989586621679083318"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8 -&gt; ByteLength -&gt; Word8
forall a. Bits a =&gt; a -&gt; ByteLength -&gt; a
</span><span class="hs-identifier hs-var">clearBit</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679083318"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span class="hs-special">)</span><span>
</span><span id="line-711"></span><span>       </span><span class="annot"><a href="#local-6989586621679083319"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-number">56</span><span> </span><span id="local-6989586621679083316"><span class="annot"><span class="annottext">w :: Word8
</span><a href="#local-6989586621679083316"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">64</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8 -&gt; ByteLength -&gt; Word8
forall a. Bits a =&gt; a -&gt; ByteLength -&gt; a
</span><span class="hs-identifier hs-var">clearBit</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679083316"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>       </span><span class="annot"><a href="#local-6989586621679083319"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679083315"><span class="annot"><span class="annottext">n :: ByteLength
</span><a href="#local-6989586621679083315"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679083314"><span class="annot"><span class="annottext">w :: Word8
</span><a href="#local-6989586621679083314"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteLength
</span><a href="#local-6989586621679083315"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679083314"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span id="local-6989586621679083997"><span class="annot"><a href="Crypto.Classes.html#ivBlockSizeBytes"><span class="hs-identifier hs-type">ivBlockSizeBytes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083997"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083997"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-715"></span><span id="ivBlockSizeBytes"><span class="annot"><span class="annottext">ivBlockSizeBytes :: IV k -&gt; ByteLength
</span><a href="Crypto.Classes.html#ivBlockSizeBytes"><span class="hs-identifier hs-var hs-var">ivBlockSizeBytes</span></a></span></span><span> </span><span id="local-6989586621679083313"><span class="annot"><span class="annottext">iv :: IV k
</span><a href="#local-6989586621679083313"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-716"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083312"><span class="annot"><span class="annottext">p :: Proxy k
</span><a href="#local-6989586621679083312"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy (IV k) -&gt; Proxy k
forall k. Proxy (IV k) -&gt; Proxy k
</span><a href="Crypto.Classes.html#deIVProxy"><span class="hs-identifier hs-var">deIVProxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IV k -&gt; Proxy (IV k)
forall a. a -&gt; Proxy a
</span><a href="#local-6989586621679083311"><span class="hs-identifier hs-var">proxyOf</span></a></span><span> </span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083313"><span class="hs-identifier hs-var">iv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; Proxy k -&gt; ByteLength
forall k (s :: k) a (proxy :: k -&gt; *). Tagged s a -&gt; proxy s -&gt; a
</span><span class="hs-identifier hs-var">proxy</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy k
</span><a href="#local-6989586621679083312"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">ByteLength -&gt; ByteLength -&gt; ByteLength
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span>
</span><span id="line-718"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-719"></span><span>  </span><span id="local-6989586621679083850"><span class="annot"><a href="#local-6989586621679083311"><span class="hs-identifier hs-type">proxyOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679083850"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679083850"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-720"></span><span>  </span><span id="local-6989586621679083311"><span class="annot"><span class="annottext">proxyOf :: a -&gt; Proxy a
</span><a href="#local-6989586621679083311"><span class="hs-identifier hs-var hs-var">proxyOf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy a -&gt; a -&gt; Proxy a
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Proxy a
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-721"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Crypto.Classes.html#ivBlockSizeBytes"><span class="hs-pragma hs-type">ivBlockSizeBytes</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span id="local-6989586621679083310"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083310"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083310"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-724"></span><span>        </span><span id="local-6989586621679083306"><span class="annot"><span class="annottext">get :: Get (IV k)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-725"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083304"><span class="annot"><span class="annottext">p :: Proxy t
</span><a href="#local-6989586621679083304"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy t
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-726"></span><span>                    </span><span id="local-6989586621679083841"><span class="annot"><a href="#local-6989586621679083303"><span class="hs-identifier hs-type">doGet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083841"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679083841"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Get</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083841"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-727"></span><span>                    </span><span id="local-6989586621679083303"><span class="annot"><span class="annottext">doGet :: Proxy k -&gt; Get (IV k)
</span><a href="#local-6989586621679083303"><span class="hs-identifier hs-var hs-var">doGet</span></a></span></span><span> </span><span id="local-6989586621679083302"><span class="annot"><span class="annottext">pr :: Proxy k
</span><a href="#local-6989586621679083302"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IV k) -&gt; Get ByteString -&gt; Get (IV k)
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IV k
forall k. ByteString -&gt; IV k
</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteLength -&gt; Get ByteString
</span><span class="hs-identifier hs-var">SG.getByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tagged k ByteLength -&gt; Proxy k -&gt; ByteLength
forall k (s :: k) a (proxy :: k -&gt; *). Tagged s a -&gt; proxy s -&gt; a
</span><span class="hs-identifier hs-var">proxy</span></span><span> </span><span class="annot"><span class="annottext">Tagged k ByteLength
forall k. BlockCipher k =&gt; Tagged k ByteLength
</span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var">blockSizeBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy k
</span><a href="#local-6989586621679083302"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>                </span><span id="local-6989586621679083300"><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083300"><span class="hs-identifier hs-var">iv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Proxy k -&gt; Get (IV k)
forall k. BlockCipher k =&gt; Proxy k -&gt; Get (IV k)
</span><a href="#local-6989586621679083303"><span class="hs-identifier hs-var">doGet</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy k
forall t. Proxy t
</span><a href="#local-6989586621679083304"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-729"></span><span>                </span><span class="annot"><span class="annottext">IV k -&gt; Get (IV k)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IV k
</span><a href="#local-6989586621679083300"><span class="hs-identifier hs-var">iv</span></a></span><span> </span><span class="annot"><span class="annottext">IV k -&gt; Proxy (IV k) -&gt; IV k
forall a (proxy :: * -&gt; *). a -&gt; proxy a -&gt; a
</span><span class="hs-operator hs-var">`asProxyTypeOf`</span></span><span> </span><span class="annot"><span class="annottext">Proxy k -&gt; Proxy (IV k)
forall k. Proxy k -&gt; Proxy (IV k)
</span><a href="Crypto.Classes.html#ivProxy"><span class="hs-identifier hs-var">ivProxy</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy k
forall t. Proxy t
</span><a href="#local-6989586621679083304"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>        </span><span id="local-6989586621679083299"><span class="annot"><span class="annottext">put :: Putter (IV k)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">put</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a></span><span> </span><span id="local-6989586621679083297"><span class="annot"><span class="annottext">iv :: ByteString
</span><a href="#local-6989586621679083297"><span class="hs-identifier hs-var">iv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Putter ByteString
</span><span class="hs-identifier hs-var">SP.putByteString</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083297"><span class="hs-identifier hs-var">iv</span></a></span></span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span></pre></body></html>