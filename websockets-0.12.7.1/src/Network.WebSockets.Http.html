<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- | Module dealing with HTTP: request data types, encoding and decoding...</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings  #-}</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.WebSockets.Http</span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Headers"><span class="hs-identifier">Headers</span></a></span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier">RequestHead</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Request"><span class="hs-identifier">Request</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier">ResponseHead</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Response"><span class="hs-identifier">Response</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#HandshakeException"><span class="hs-identifier">HandshakeException</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#encodeRequestHead"><span class="hs-identifier">encodeRequestHead</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#encodeRequest"><span class="hs-identifier">encodeRequest</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#decodeRequestHead"><span class="hs-identifier">decodeRequestHead</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#encodeResponseHead"><span class="hs-identifier">encodeResponseHead</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#encodeResponse"><span class="hs-identifier">encodeResponse</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#decodeResponseHead"><span class="hs-identifier">decodeResponseHead</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#decodeResponse"><span class="hs-identifier">decodeResponse</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#response101"><span class="hs-identifier">response101</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#response400"><span class="hs-identifier">response400</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#getRequestHeader"><span class="hs-identifier">getRequestHeader</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#getResponseHeader"><span class="hs-identifier">getResponseHeader</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#getRequestSecWebSocketVersion"><span class="hs-identifier">getRequestSecWebSocketVersion</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#getRequestSubprotocols"><span class="hs-identifier">getRequestSubprotocols</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#getRequestSecWebSocketExtensions"><span class="hs-identifier">getRequestSecWebSocketExtensions</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Builder</span></span><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Builder</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Builder.Extra</span></span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Builder</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pure</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(*&gt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;$&gt;)</span></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>                                                            </span><span class="annot"><span class="hs-operator">(&lt;*)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;*&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Exception</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Attoparsec.ByteString</span></span><span>                </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span>                           </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span>                     </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span>                     </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BC</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.ByteString.Internal</span></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">c2w</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.CaseInsensitive</span></span><span>                      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CI</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Dynamic</span></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Typeable</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mappend</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mconcat</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Network.WebSockets.Extensions.Description.html"><span class="hs-identifier">Network.WebSockets.Extensions.Description</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Extensions</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- | Request headers</span><span>
</span><span id="line-53"></span><span class="hs-keyword">type</span><span> </span><span id="Headers"><span class="annot"><a href="Network.WebSockets.Http.html#Headers"><span class="hs-identifier hs-var">Headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CI.CI</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- | An HTTP request. The request body is not yet read.</span><span>
</span><span id="line-58"></span><span class="hs-keyword">data</span><span> </span><span id="RequestHead"><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-var">RequestHead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RequestHead"><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-var">RequestHead</span></a></span></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="requestPath"><span class="annot"><span class="annottext">RequestHead -&gt; ByteString
</span><a href="Network.WebSockets.Http.html#requestPath"><span class="hs-identifier hs-var hs-var">requestPath</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="requestHeaders"><span class="annot"><span class="annottext">RequestHead -&gt; Headers
</span><a href="Network.WebSockets.Http.html#requestHeaders"><span class="hs-identifier hs-var hs-var">requestHeaders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Headers"><span class="hs-identifier hs-type">Headers</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="requestSecure"><span class="annot"><span class="annottext">RequestHead -&gt; Bool
</span><a href="Network.WebSockets.Http.html#requestSecure"><span class="hs-identifier hs-var hs-var">requestSecure</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679112081"><span id="local-6989586621679112083"><span id="local-6989586621679112085"><span class="annot"><span class="annottext">Int -&gt; RequestHead -&gt; ShowS
[RequestHead] -&gt; ShowS
RequestHead -&gt; String
(Int -&gt; RequestHead -&gt; ShowS)
-&gt; (RequestHead -&gt; String)
-&gt; ([RequestHead] -&gt; ShowS)
-&gt; Show RequestHead
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RequestHead] -&gt; ShowS
$cshowList :: [RequestHead] -&gt; ShowS
show :: RequestHead -&gt; String
$cshow :: RequestHead -&gt; String
showsPrec :: Int -&gt; RequestHead -&gt; ShowS
$cshowsPrec :: Int -&gt; RequestHead -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- | A request with a body</span><span>
</span><span id="line-67"></span><span class="hs-keyword">data</span><span> </span><span id="Request"><span class="annot"><a href="Network.WebSockets.Http.html#Request"><span class="hs-identifier hs-var">Request</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Request"><span class="annot"><a href="Network.WebSockets.Http.html#Request"><span class="hs-identifier hs-var">Request</span></a></span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-type">RequestHead</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679112073"><span id="local-6989586621679112075"><span id="local-6989586621679112077"><span class="annot"><span class="annottext">Int -&gt; Request -&gt; ShowS
[Request] -&gt; ShowS
Request -&gt; String
(Int -&gt; Request -&gt; ShowS)
-&gt; (Request -&gt; String) -&gt; ([Request] -&gt; ShowS) -&gt; Show Request
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Request] -&gt; ShowS
$cshowList :: [Request] -&gt; ShowS
show :: Request -&gt; String
$cshow :: Request -&gt; String
showsPrec :: Int -&gt; Request -&gt; ShowS
$cshowsPrec :: Int -&gt; Request -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | HTTP response, without body.</span><span>
</span><span id="line-73"></span><span class="hs-keyword">data</span><span> </span><span id="ResponseHead"><span class="annot"><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier hs-var">ResponseHead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ResponseHead"><span class="annot"><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier hs-var">ResponseHead</span></a></span></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="responseCode"><span class="annot"><span class="annottext">ResponseHead -&gt; Int
</span><a href="Network.WebSockets.Http.html#responseCode"><span class="hs-identifier hs-var hs-var">responseCode</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="responseMessage"><span class="annot"><span class="annottext">ResponseHead -&gt; ByteString
</span><a href="Network.WebSockets.Http.html#responseMessage"><span class="hs-identifier hs-var hs-var">responseMessage</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="responseHeaders"><span class="annot"><span class="annottext">ResponseHead -&gt; Headers
</span><a href="Network.WebSockets.Http.html#responseHeaders"><span class="hs-identifier hs-var hs-var">responseHeaders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Headers"><span class="hs-identifier hs-type">Headers</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679112063"><span id="local-6989586621679112065"><span id="local-6989586621679112067"><span class="annot"><span class="annottext">Int -&gt; ResponseHead -&gt; ShowS
[ResponseHead] -&gt; ShowS
ResponseHead -&gt; String
(Int -&gt; ResponseHead -&gt; ShowS)
-&gt; (ResponseHead -&gt; String)
-&gt; ([ResponseHead] -&gt; ShowS)
-&gt; Show ResponseHead
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ResponseHead] -&gt; ShowS
$cshowList :: [ResponseHead] -&gt; ShowS
show :: ResponseHead -&gt; String
$cshow :: ResponseHead -&gt; String
showsPrec :: Int -&gt; ResponseHead -&gt; ShowS
$cshowsPrec :: Int -&gt; ResponseHead -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | A response including a body</span><span>
</span><span id="line-82"></span><span class="hs-keyword">data</span><span> </span><span id="Response"><span class="annot"><a href="Network.WebSockets.Http.html#Response"><span class="hs-identifier hs-var">Response</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Response"><span class="annot"><a href="Network.WebSockets.Http.html#Response"><span class="hs-identifier hs-var">Response</span></a></span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier hs-type">ResponseHead</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679112056"><span id="local-6989586621679112058"><span id="local-6989586621679112060"><span class="annot"><span class="annottext">Int -&gt; Response -&gt; ShowS
[Response] -&gt; ShowS
Response -&gt; String
(Int -&gt; Response -&gt; ShowS)
-&gt; (Response -&gt; String) -&gt; ([Response] -&gt; ShowS) -&gt; Show Response
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Response] -&gt; ShowS
$cshowList :: [Response] -&gt; ShowS
show :: Response -&gt; String
$cshow :: Response -&gt; String
showsPrec :: Int -&gt; Response -&gt; ShowS
$cshowsPrec :: Int -&gt; Response -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- | Error in case of failed handshake. Will be thrown as an 'Exception'.</span><span>
</span><span id="line-88"></span><span class="hs-comment">--</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- TODO: This should probably be in the Handshake module, and is solely here to</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- prevent a cyclic dependency.</span><span>
</span><span id="line-91"></span><span class="hs-keyword">data</span><span> </span><span id="HandshakeException"><span class="annot"><a href="Network.WebSockets.Http.html#HandshakeException"><span class="hs-identifier hs-var">HandshakeException</span></a></span></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-comment">-- | We don't have a match for the protocol requested by the client.</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-comment">-- todo: version parameter</span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="NotSupported"><span class="annot"><a href="Network.WebSockets.Http.html#NotSupported"><span class="hs-identifier hs-var">NotSupported</span></a></span></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-comment">-- | The request was somehow invalid (missing headers or wrong security</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-comment">-- token)</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MalformedRequest"><span class="annot"><a href="Network.WebSockets.Http.html#MalformedRequest"><span class="hs-identifier hs-var">MalformedRequest</span></a></span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-type">RequestHead</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-comment">-- | The servers response was somehow invalid (missing headers or wrong</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-comment">-- security token)</span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MalformedResponse"><span class="annot"><a href="Network.WebSockets.Http.html#MalformedResponse"><span class="hs-identifier hs-var">MalformedResponse</span></a></span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier hs-type">ResponseHead</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-comment">-- | The request was well-formed, but the library user rejected it.</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-comment">-- (e.g. &quot;unknown path&quot;)</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="RequestRejected"><span class="annot"><a href="Network.WebSockets.Http.html#RequestRejected"><span class="hs-identifier hs-var">RequestRejected</span></a></span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-comment">-- | for example &quot;EOF came too early&quot; (which is actually a parse error)</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-comment">-- or for your own errors. (like &quot;unknown path&quot;?)</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="OtherHandshakeException"><span class="annot"><a href="Network.WebSockets.Http.html#OtherHandshakeException"><span class="hs-identifier hs-var">OtherHandshakeException</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679112045"><span id="local-6989586621679112047"><span id="local-6989586621679112049"><span class="annot"><span class="annottext">Int -&gt; HandshakeException -&gt; ShowS
[HandshakeException] -&gt; ShowS
HandshakeException -&gt; String
(Int -&gt; HandshakeException -&gt; ShowS)
-&gt; (HandshakeException -&gt; String)
-&gt; ([HandshakeException] -&gt; ShowS)
-&gt; Show HandshakeException
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [HandshakeException] -&gt; ShowS
$cshowList :: [HandshakeException] -&gt; ShowS
show :: HandshakeException -&gt; String
$cshow :: HandshakeException -&gt; String
showsPrec :: Int -&gt; HandshakeException -&gt; ShowS
$cshowsPrec :: Int -&gt; HandshakeException -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-111"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679112037"><span id="local-6989586621679112039"><span id="local-6989586621679112041"><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#HandshakeException"><span class="hs-identifier hs-type">HandshakeException</span></a></span></span></span></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-115"></span><span class="annot"><a href="Network.WebSockets.Http.html#encodeRequestHead"><span class="hs-identifier hs-type">encodeRequestHead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-type">RequestHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Builder.Builder</span></span><span>
</span><span id="line-116"></span><span id="encodeRequestHead"><span class="annot"><span class="annottext">encodeRequestHead :: RequestHead -&gt; Builder
</span><a href="Network.WebSockets.Http.html#encodeRequestHead"><span class="hs-identifier hs-var hs-var">encodeRequestHead</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-type">RequestHead</span></a></span><span> </span><span id="local-6989586621679112035"><span class="annot"><span class="annottext">path :: ByteString
</span><a href="#local-6989586621679112035"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679112034"><span class="annot"><span class="annottext">headers :: Headers
</span><a href="#local-6989586621679112034"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteStringCopy</span></span><span> </span><span class="annot"><span class="hs-string">&quot;GET &quot;</span></span><span>      </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteStringCopy</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112035"><span class="hs-identifier hs-var">path</span></a></span><span>        </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteStringCopy</span></span><span> </span><span class="annot"><span class="hs-string">&quot; HTTP/1.1&quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteString</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\r\n&quot;</span></span><span>          </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><span class="annottext">[Builder] -&gt; Builder
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((CI ByteString, ByteString) -&gt; Builder) -&gt; Headers -&gt; [Builder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(CI ByteString, ByteString) -&gt; Builder
</span><a href="#local-6989586621679112031"><span class="hs-identifier hs-var">header</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679112034"><span class="hs-identifier hs-var">headers</span></a></span><span class="hs-special">)</span><span>       </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteStringCopy</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\r\n&quot;</span></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679112031"><span class="annot"><span class="annottext">header :: (CI ByteString, ByteString) -&gt; Builder
</span><a href="#local-6989586621679112031"><span class="hs-identifier hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679112030"><span class="annot"><span class="annottext">k :: CI ByteString
</span><a href="#local-6989586621679112030"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679112029"><span class="annot"><span class="annottext">v :: ByteString
</span><a href="#local-6989586621679112029"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Builder] -&gt; Builder
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Builder] -&gt; Builder) -&gt; [Builder] -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Builder) -&gt; [ByteString] -&gt; [Builder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteStringCopy</span></span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CI ByteString -&gt; ByteString
forall s. CI s -&gt; s
</span><span class="hs-identifier hs-var hs-var">CI.original</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><a href="#local-6989586621679112030"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112029"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;\r\n&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-129"></span><span class="annot"><a href="Network.WebSockets.Http.html#encodeRequest"><span class="hs-identifier hs-type">encodeRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Builder.Builder</span></span><span>
</span><span id="line-130"></span><span id="encodeRequest"><span class="annot"><span class="annottext">encodeRequest :: Request -&gt; Builder
</span><a href="Network.WebSockets.Http.html#encodeRequest"><span class="hs-identifier hs-var hs-var">encodeRequest</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.WebSockets.Http.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span id="local-6989586621679112027"><span class="annot"><span class="annottext">head' :: RequestHead
</span><a href="#local-6989586621679112027"><span class="hs-identifier hs-var">head'</span></a></span></span><span> </span><span id="local-6989586621679112026"><span class="annot"><span class="annottext">body :: ByteString
</span><a href="#local-6989586621679112026"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="annottext">RequestHead -&gt; Builder
</span><a href="Network.WebSockets.Http.html#encodeRequestHead"><span class="hs-identifier hs-var">encodeRequestHead</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHead
</span><a href="#local-6989586621679112027"><span class="hs-identifier hs-var">head'</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteStringCopy</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112026"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | Parse an initial request</span><span>
</span><span id="line-136"></span><span class="annot"><a href="Network.WebSockets.Http.html#decodeRequestHead"><span class="hs-identifier hs-type">decodeRequestHead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-type">RequestHead</span></a></span><span>
</span><span id="line-137"></span><span id="decodeRequestHead"><span class="annot"><span class="annottext">decodeRequestHead :: Bool -&gt; Parser RequestHead
</span><a href="Network.WebSockets.Http.html#decodeRequestHead"><span class="hs-identifier hs-var hs-var">decodeRequestHead</span></a></span></span><span> </span><span id="local-6989586621679112025"><span class="annot"><span class="annottext">isSecure :: Bool
</span><a href="#local-6989586621679112025"><span class="hs-identifier hs-var">isSecure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Headers -&gt; Bool -&gt; RequestHead
</span><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-var">RequestHead</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">(ByteString -&gt; Headers -&gt; Bool -&gt; RequestHead)
-&gt; Parser ByteString ByteString
-&gt; Parser ByteString (Headers -&gt; Bool -&gt; RequestHead)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679112024"><span class="hs-identifier hs-var">requestLine</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">Parser ByteString (Headers -&gt; Bool -&gt; RequestHead)
-&gt; Parser ByteString Headers
-&gt; Parser ByteString (Bool -&gt; RequestHead)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString (CI ByteString, ByteString)
-&gt; Parser ByteString ByteString -&gt; Parser ByteString Headers
forall (f :: * -&gt; *) a b. Alternative f =&gt; f a -&gt; f b -&gt; f [a]
</span><span class="hs-identifier hs-var">A.manyTill</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString (CI ByteString, ByteString)
</span><a href="Network.WebSockets.Http.html#decodeHeaderLine"><span class="hs-identifier hs-var">decodeHeaderLine</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679112021"><span class="hs-identifier hs-var">newline</span></a></span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="annottext">Parser ByteString (Bool -&gt; RequestHead)
-&gt; Parser ByteString Bool -&gt; Parser RequestHead
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser ByteString Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112025"><span class="hs-identifier hs-var">isSecure</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621679112020"><span class="annot"><span class="annottext">space :: Parser Word8
</span><a href="#local-6989586621679112020"><span class="hs-identifier hs-var hs-var">space</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Word8
</span><span class="hs-identifier hs-var">A.word8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><span class="hs-identifier hs-var">c2w</span></span><span> </span><span class="annot"><span class="hs-char">' '</span></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621679112021"><span class="annot"><span class="annottext">newline :: Parser ByteString ByteString
</span><a href="#local-6989586621679112021"><span class="hs-identifier hs-var hs-var">newline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.string</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\r\n&quot;</span></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679112024"><span class="annot"><span class="annottext">requestLine :: Parser ByteString ByteString
</span><a href="#local-6989586621679112024"><span class="hs-identifier hs-var hs-var">requestLine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.string</span></span><span> </span><span class="annot"><span class="hs-string">&quot;GET&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString -&gt; Parser Word8 -&gt; Parser Word8
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser Word8
</span><a href="#local-6989586621679112020"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Parser Word8
-&gt; Parser ByteString ByteString -&gt; Parser ByteString ByteString
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Bool) -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeWhile1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><span class="hs-identifier hs-var">c2w</span></span><span> </span><span class="annot"><span class="hs-char">' '</span></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; Parser Word8 -&gt; Parser ByteString ByteString
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">Parser Word8
</span><a href="#local-6989586621679112020"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-147"></span><span>        </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; Parser ByteString ByteString -&gt; Parser ByteString ByteString
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.string</span></span><span> </span><span class="annot"><span class="hs-string">&quot;HTTP/1.1&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; Parser ByteString ByteString -&gt; Parser ByteString ByteString
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679112021"><span class="hs-identifier hs-var">newline</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- | Encode an HTTP upgrade response</span><span>
</span><span id="line-152"></span><span class="annot"><a href="Network.WebSockets.Http.html#encodeResponseHead"><span class="hs-identifier hs-type">encodeResponseHead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier hs-type">ResponseHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Builder.Builder</span></span><span>
</span><span id="line-153"></span><span id="encodeResponseHead"><span class="annot"><span class="annottext">encodeResponseHead :: ResponseHead -&gt; Builder
</span><a href="Network.WebSockets.Http.html#encodeResponseHead"><span class="hs-identifier hs-var hs-var">encodeResponseHead</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier hs-type">ResponseHead</span></a></span><span> </span><span id="local-6989586621679112015"><span class="annot"><span class="annottext">code :: Int
</span><a href="#local-6989586621679112015"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span id="local-6989586621679112014"><span class="annot"><span class="annottext">msg :: ByteString
</span><a href="#local-6989586621679112014"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679112013"><span class="annot"><span class="annottext">headers :: Headers
</span><a href="#local-6989586621679112013"><span class="hs-identifier hs-var">headers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteStringCopy</span></span><span> </span><span class="annot"><span class="hs-string">&quot;HTTP/1.1 &quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.stringUtf8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679112015"><span class="hs-identifier hs-var">code</span></a></span><span class="hs-special">)</span><span>     </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="annottext">Char -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.charUtf8</span></span><span> </span><span class="annot"><span class="hs-char">' '</span></span><span>               </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteString</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112014"><span class="hs-identifier hs-var">msg</span></a></span><span>             </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteString</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\r\n&quot;</span></span><span>          </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">[Builder] -&gt; Builder
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((CI ByteString, ByteString) -&gt; Builder) -&gt; Headers -&gt; [Builder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(CI ByteString, ByteString) -&gt; Builder
</span><a href="#local-6989586621679112009"><span class="hs-identifier hs-var">header</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679112013"><span class="hs-identifier hs-var">headers</span></a></span><span class="hs-special">)</span><span>       </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteStringCopy</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\r\n&quot;</span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621679112009"><span class="annot"><span class="annottext">header :: (CI ByteString, ByteString) -&gt; Builder
</span><a href="#local-6989586621679112009"><span class="hs-identifier hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679112008"><span class="annot"><span class="annottext">k :: CI ByteString
</span><a href="#local-6989586621679112008"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679112007"><span class="annot"><span class="annottext">v :: ByteString
</span><a href="#local-6989586621679112007"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Builder] -&gt; Builder
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Builder] -&gt; Builder) -&gt; [Builder] -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Builder) -&gt; [ByteString] -&gt; [Builder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteStringCopy</span></span><span>
</span><span id="line-163"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CI ByteString -&gt; ByteString
forall s. CI s -&gt; s
</span><span class="hs-identifier hs-var hs-var">CI.original</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><a href="#local-6989586621679112008"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112007"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;\r\n&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-167"></span><span class="annot"><a href="Network.WebSockets.Http.html#encodeResponse"><span class="hs-identifier hs-type">encodeResponse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Builder.Builder</span></span><span>
</span><span id="line-168"></span><span id="encodeResponse"><span class="annot"><span class="annottext">encodeResponse :: Response -&gt; Builder
</span><a href="Network.WebSockets.Http.html#encodeResponse"><span class="hs-identifier hs-var hs-var">encodeResponse</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.WebSockets.Http.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span id="local-6989586621679112006"><span class="annot"><span class="annottext">head' :: ResponseHead
</span><a href="#local-6989586621679112006"><span class="hs-identifier hs-var">head'</span></a></span></span><span> </span><span id="local-6989586621679112005"><span class="annot"><span class="annottext">body :: ByteString
</span><a href="#local-6989586621679112005"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><span class="annottext">ResponseHead -&gt; Builder
</span><a href="Network.WebSockets.Http.html#encodeResponseHead"><span class="hs-identifier hs-var">encodeResponseHead</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHead
</span><a href="#local-6989586621679112006"><span class="hs-identifier hs-var">head'</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><span class="hs-identifier hs-var">Builder.byteStringCopy</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112005"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- | An upgrade response</span><span>
</span><span id="line-174"></span><span class="annot"><a href="Network.WebSockets.Http.html#response101"><span class="hs-identifier hs-type">response101</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Headers"><span class="hs-identifier hs-type">Headers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span>
</span><span id="line-175"></span><span id="response101"><span class="annot"><span class="annottext">response101 :: Headers -&gt; ByteString -&gt; Response
</span><a href="Network.WebSockets.Http.html#response101"><span class="hs-identifier hs-var hs-var">response101</span></a></span></span><span> </span><span id="local-6989586621679112004"><span class="annot"><span class="annottext">headers :: Headers
</span><a href="#local-6989586621679112004"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResponseHead -&gt; ByteString -&gt; Response
</span><a href="Network.WebSockets.Http.html#Response"><span class="hs-identifier hs-var">Response</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; Headers -&gt; ResponseHead
</span><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier hs-var">ResponseHead</span></a></span><span> </span><span class="annot"><span class="hs-number">101</span></span><span> </span><span class="annot"><span class="hs-string">&quot;WebSocket Protocol Handshake&quot;</span></span><span>
</span><span id="line-177"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Upgrade&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;websocket&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CI ByteString, ByteString) -&gt; Headers -&gt; Headers
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Connection&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;Upgrade&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CI ByteString, ByteString) -&gt; Headers -&gt; Headers
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679112004"><span class="hs-identifier hs-var">headers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- | Bad request</span><span>
</span><span id="line-182"></span><span class="annot"><a href="Network.WebSockets.Http.html#response400"><span class="hs-identifier hs-type">response400</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Headers"><span class="hs-identifier hs-type">Headers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span>
</span><span id="line-183"></span><span id="response400"><span class="annot"><span class="annottext">response400 :: Headers -&gt; ByteString -&gt; Response
</span><a href="Network.WebSockets.Http.html#response400"><span class="hs-identifier hs-var hs-var">response400</span></a></span></span><span> </span><span id="local-6989586621679112003"><span class="annot"><span class="annottext">headers :: Headers
</span><a href="#local-6989586621679112003"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResponseHead -&gt; ByteString -&gt; Response
</span><a href="Network.WebSockets.Http.html#Response"><span class="hs-identifier hs-var">Response</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; Headers -&gt; ResponseHead
</span><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier hs-var">ResponseHead</span></a></span><span> </span><span class="annot"><span class="hs-number">400</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Bad Request&quot;</span></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679112003"><span class="hs-identifier hs-var">headers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- | HTTP response parser</span><span>
</span><span id="line-188"></span><span class="annot"><a href="Network.WebSockets.Http.html#decodeResponseHead"><span class="hs-identifier hs-type">decodeResponseHead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier hs-type">ResponseHead</span></a></span><span>
</span><span id="line-189"></span><span id="decodeResponseHead"><span class="annot"><span class="annottext">decodeResponseHead :: Parser ResponseHead
</span><a href="Network.WebSockets.Http.html#decodeResponseHead"><span class="hs-identifier hs-var hs-var">decodeResponseHead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; Headers -&gt; ResponseHead
</span><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier hs-var">ResponseHead</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">(Int -&gt; ByteString -&gt; Headers -&gt; ResponseHead)
-&gt; Parser ByteString Int
-&gt; Parser ByteString (ByteString -&gt; Headers -&gt; ResponseHead)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Int)
-&gt; Parser ByteString ByteString -&gt; Parser ByteString Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Int
forall a. Read a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Int) -&gt; (ByteString -&gt; String) -&gt; ByteString -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><span class="hs-identifier hs-var">BC.unpack</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679111999"><span class="hs-identifier hs-var">code</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">Parser ByteString (ByteString -&gt; Headers -&gt; ResponseHead)
-&gt; Parser ByteString ByteString
-&gt; Parser ByteString (Headers -&gt; ResponseHead)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679111998"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="annottext">Parser ByteString (Headers -&gt; ResponseHead)
-&gt; Parser ByteString Headers -&gt; Parser ResponseHead
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString (CI ByteString, ByteString)
-&gt; Parser ByteString ByteString -&gt; Parser ByteString Headers
forall (f :: * -&gt; *) a b. Alternative f =&gt; f a -&gt; f b -&gt; f [a]
</span><span class="hs-identifier hs-var">A.manyTill</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString (CI ByteString, ByteString)
</span><a href="Network.WebSockets.Http.html#decodeHeaderLine"><span class="hs-identifier hs-var">decodeHeaderLine</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679111997"><span class="hs-identifier hs-var">newline</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621679111996"><span class="annot"><span class="annottext">space :: Parser Word8
</span><a href="#local-6989586621679111996"><span class="hs-identifier hs-var hs-var">space</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Word8
</span><span class="hs-identifier hs-var">A.word8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><span class="hs-identifier hs-var">c2w</span></span><span> </span><span class="annot"><span class="hs-char">' '</span></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621679111997"><span class="annot"><span class="annottext">newline :: Parser ByteString ByteString
</span><a href="#local-6989586621679111997"><span class="hs-identifier hs-var hs-var">newline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.string</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\r\n&quot;</span></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>    </span><span id="local-6989586621679111999"><span class="annot"><span class="annottext">code :: Parser ByteString ByteString
</span><a href="#local-6989586621679111999"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.string</span></span><span> </span><span class="annot"><span class="hs-string">&quot;HTTP/1.1&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString -&gt; Parser Word8 -&gt; Parser Word8
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser Word8
</span><a href="#local-6989586621679111996"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Parser Word8
-&gt; Parser ByteString ByteString -&gt; Parser ByteString ByteString
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Bool) -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeWhile1</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Bool
</span><a href="#local-6989586621679111995"><span class="hs-identifier hs-var">digit</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; Parser Word8 -&gt; Parser ByteString ByteString
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">Parser Word8
</span><a href="#local-6989586621679111996"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621679111995"><span class="annot"><span class="annottext">digit :: Word8 -&gt; Bool
</span><a href="#local-6989586621679111995"><span class="hs-identifier hs-var hs-var">digit</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679111994"><span class="annot"><span class="annottext">x :: Word8
</span><a href="#local-6989586621679111994"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679111994"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><span class="hs-identifier hs-var">c2w</span></span><span> </span><span class="annot"><span class="hs-char">'0'</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679111994"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><span class="hs-identifier hs-var">c2w</span></span><span> </span><span class="annot"><span class="hs-char">'9'</span></span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621679111998"><span class="annot"><span class="annottext">message :: Parser ByteString ByteString
</span><a href="#local-6989586621679111998"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Bool) -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><span class="hs-identifier hs-var">c2w</span></span><span> </span><span class="annot"><span class="hs-char">'\r'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; Parser ByteString ByteString -&gt; Parser ByteString ByteString
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679111997"><span class="hs-identifier hs-var">newline</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-203"></span><span class="annot"><a href="Network.WebSockets.Http.html#decodeResponse"><span class="hs-identifier hs-type">decodeResponse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span>
</span><span id="line-204"></span><span id="decodeResponse"><span class="annot"><span class="annottext">decodeResponse :: Parser Response
</span><a href="Network.WebSockets.Http.html#decodeResponse"><span class="hs-identifier hs-var hs-var">decodeResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResponseHead -&gt; ByteString -&gt; Response
</span><a href="Network.WebSockets.Http.html#Response"><span class="hs-identifier hs-var">Response</span></a></span><span> </span><span class="annot"><span class="annottext">(ResponseHead -&gt; ByteString -&gt; Response)
-&gt; Parser ResponseHead
-&gt; Parser ByteString (ByteString -&gt; Response)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser ResponseHead
</span><a href="Network.WebSockets.Http.html#decodeResponseHead"><span class="hs-identifier hs-var">decodeResponseHead</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString (ByteString -&gt; Response)
-&gt; Parser ByteString ByteString -&gt; Parser Response
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeByteString</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-208"></span><span class="annot"><a href="Network.WebSockets.Http.html#getRequestHeader"><span class="hs-identifier hs-type">getRequestHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-type">RequestHead</span></a></span><span>
</span><span id="line-209"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CI.CI</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-210"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#HandshakeException"><span class="hs-identifier hs-type">HandshakeException</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-211"></span><span id="getRequestHeader"><span class="annot"><span class="annottext">getRequestHeader :: RequestHead
-&gt; CI ByteString -&gt; Either HandshakeException ByteString
</span><a href="Network.WebSockets.Http.html#getRequestHeader"><span class="hs-identifier hs-var hs-var">getRequestHeader</span></a></span></span><span> </span><span id="local-6989586621679111989"><span class="annot"><span class="annottext">rq :: RequestHead
</span><a href="#local-6989586621679111989"><span class="hs-identifier hs-var">rq</span></a></span></span><span> </span><span id="local-6989586621679111988"><span class="annot"><span class="annottext">key :: CI ByteString
</span><a href="#local-6989586621679111988"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CI ByteString -&gt; Headers -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><a href="#local-6989586621679111988"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RequestHead -&gt; Headers
</span><a href="Network.WebSockets.Http.html#requestHeaders"><span class="hs-identifier hs-var hs-var">requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHead
</span><a href="#local-6989586621679111989"><span class="hs-identifier hs-var">rq</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679111986"><span class="annot"><span class="annottext">t :: ByteString
</span><a href="#local-6989586621679111986"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either HandshakeException ByteString
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679111986"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HandshakeException -&gt; Either HandshakeException ByteString
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(HandshakeException -&gt; Either HandshakeException ByteString)
-&gt; HandshakeException -&gt; Either HandshakeException ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequestHead -&gt; String -&gt; HandshakeException
</span><a href="Network.WebSockets.Http.html#MalformedRequest"><span class="hs-identifier hs-var">MalformedRequest</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHead
</span><a href="#local-6989586621679111989"><span class="hs-identifier hs-var">rq</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; HandshakeException) -&gt; String -&gt; HandshakeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><span class="hs-string">&quot;Header missing: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><span class="hs-identifier hs-var">BC.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString -&gt; ByteString
forall s. CI s -&gt; s
</span><span class="hs-identifier hs-var hs-var">CI.original</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><a href="#local-6989586621679111988"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-218"></span><span class="annot"><a href="Network.WebSockets.Http.html#getResponseHeader"><span class="hs-identifier hs-type">getResponseHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#ResponseHead"><span class="hs-identifier hs-type">ResponseHead</span></a></span><span>
</span><span id="line-219"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CI.CI</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-220"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#HandshakeException"><span class="hs-identifier hs-type">HandshakeException</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-221"></span><span id="getResponseHeader"><span class="annot"><span class="annottext">getResponseHeader :: ResponseHead
-&gt; CI ByteString -&gt; Either HandshakeException ByteString
</span><a href="Network.WebSockets.Http.html#getResponseHeader"><span class="hs-identifier hs-var hs-var">getResponseHeader</span></a></span></span><span> </span><span id="local-6989586621679111985"><span class="annot"><span class="annottext">rsp :: ResponseHead
</span><a href="#local-6989586621679111985"><span class="hs-identifier hs-var">rsp</span></a></span></span><span> </span><span id="local-6989586621679111984"><span class="annot"><span class="annottext">key :: CI ByteString
</span><a href="#local-6989586621679111984"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CI ByteString -&gt; Headers -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><a href="#local-6989586621679111984"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResponseHead -&gt; Headers
</span><a href="Network.WebSockets.Http.html#responseHeaders"><span class="hs-identifier hs-var hs-var">responseHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHead
</span><a href="#local-6989586621679111985"><span class="hs-identifier hs-var">rsp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679111983"><span class="annot"><span class="annottext">t :: ByteString
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either HandshakeException ByteString
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HandshakeException -&gt; Either HandshakeException ByteString
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(HandshakeException -&gt; Either HandshakeException ByteString)
-&gt; HandshakeException -&gt; Either HandshakeException ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResponseHead -&gt; String -&gt; HandshakeException
</span><a href="Network.WebSockets.Http.html#MalformedResponse"><span class="hs-identifier hs-var">MalformedResponse</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHead
</span><a href="#local-6989586621679111985"><span class="hs-identifier hs-var">rsp</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; HandshakeException) -&gt; String -&gt; HandshakeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-224"></span><span>        </span><span class="annot"><span class="hs-string">&quot;Header missing: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><span class="hs-identifier hs-var">BC.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString -&gt; ByteString
forall s. CI s -&gt; s
</span><span class="hs-identifier hs-var hs-var">CI.original</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><a href="#local-6989586621679111984"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- | Get the @Sec-WebSocket-Version@ header</span><span>
</span><span id="line-229"></span><span class="annot"><a href="Network.WebSockets.Http.html#getRequestSecWebSocketVersion"><span class="hs-identifier hs-type">getRequestSecWebSocketVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-type">RequestHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-230"></span><span id="getRequestSecWebSocketVersion"><span class="annot"><span class="annottext">getRequestSecWebSocketVersion :: RequestHead -&gt; Maybe ByteString
</span><a href="Network.WebSockets.Http.html#getRequestSecWebSocketVersion"><span class="hs-identifier hs-var hs-var">getRequestSecWebSocketVersion</span></a></span></span><span> </span><span id="local-6989586621679111982"><span class="annot"><span class="annottext">p :: RequestHead
</span><a href="#local-6989586621679111982"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">CI ByteString -&gt; Headers -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Sec-WebSocket-Version&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RequestHead -&gt; Headers
</span><a href="Network.WebSockets.Http.html#requestHeaders"><span class="hs-identifier hs-var hs-var">requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHead
</span><a href="#local-6989586621679111982"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- | List of subprotocols specified by the client, in order of preference.</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- If the client did not specify a list of subprotocols, this will be the</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- empty list.</span><span>
</span><span id="line-238"></span><span class="annot"><a href="Network.WebSockets.Http.html#getRequestSubprotocols"><span class="hs-identifier hs-type">getRequestSubprotocols</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-type">RequestHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">]</span><span>
</span><span id="line-239"></span><span id="getRequestSubprotocols"><span class="annot"><span class="annottext">getRequestSubprotocols :: RequestHead -&gt; [ByteString]
</span><a href="Network.WebSockets.Http.html#getRequestSubprotocols"><span class="hs-identifier hs-var hs-var">getRequestSubprotocols</span></a></span></span><span> </span><span id="local-6989586621679111981"><span class="annot"><span class="annottext">rh :: RequestHead
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">rh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString]
-&gt; (ByteString -&gt; [ByteString]) -&gt; Maybe ByteString -&gt; [ByteString]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="#local-6989586621679111979"><span class="hs-identifier hs-var">parse</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679111978"><span class="hs-identifier hs-var">mproto</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-241"></span><span>        </span><span id="local-6989586621679111978"><span class="annot"><span class="annottext">mproto :: Maybe ByteString
</span><a href="#local-6989586621679111978"><span class="hs-identifier hs-var hs-var">mproto</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CI ByteString -&gt; Headers -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Sec-WebSocket-Protocol&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Headers -&gt; Maybe ByteString) -&gt; Headers -&gt; Maybe ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequestHead -&gt; Headers
</span><a href="Network.WebSockets.Http.html#requestHeaders"><span class="hs-identifier hs-var hs-var">requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHead
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">rh</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span id="local-6989586621679111979"><span class="annot"><span class="annottext">parse :: ByteString -&gt; [ByteString]
</span><a href="#local-6989586621679111979"><span class="hs-identifier hs-var hs-var">parse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Bool) -&gt; [ByteString] -&gt; [ByteString]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (ByteString -&gt; Bool) -&gt; ByteString -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">B.null</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; [ByteString])
-&gt; (ByteString -&gt; [ByteString]) -&gt; ByteString -&gt; [ByteString]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">BC.splitWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679111974"><span class="annot"><span class="annottext">o :: Char
</span><a href="#local-6989586621679111974"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679111974"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-char">','</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679111974"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-char">' '</span></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- | Get the @Sec-WebSocket-Extensions@ header</span><span>
</span><span id="line-247"></span><span class="annot"><a href="Network.WebSockets.Http.html#getRequestSecWebSocketExtensions"><span class="hs-identifier hs-type">getRequestSecWebSocketExtensions</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#RequestHead"><span class="hs-identifier hs-type">RequestHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Network.WebSockets.Http.html#HandshakeException"><span class="hs-identifier hs-type">HandshakeException</span></a></span><span> </span><span class="annot"><a href="Network.WebSockets.Extensions.Description.html#ExtensionDescriptions"><span class="hs-identifier hs-type">Extensions.ExtensionDescriptions</span></a></span><span>
</span><span id="line-249"></span><span id="getRequestSecWebSocketExtensions"><span class="annot"><span class="annottext">getRequestSecWebSocketExtensions :: RequestHead -&gt; Either HandshakeException ExtensionDescriptions
</span><a href="Network.WebSockets.Http.html#getRequestSecWebSocketExtensions"><span class="hs-identifier hs-var hs-var">getRequestSecWebSocketExtensions</span></a></span></span><span> </span><span id="local-6989586621679111972"><span class="annot"><span class="annottext">rq :: RequestHead
</span><a href="#local-6989586621679111972"><span class="hs-identifier hs-var">rq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CI ByteString -&gt; Headers -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Sec-WebSocket-Extensions&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RequestHead -&gt; Headers
</span><a href="Network.WebSockets.Http.html#requestHeaders"><span class="hs-identifier hs-var hs-var">requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHead
</span><a href="#local-6989586621679111972"><span class="hs-identifier hs-var">rq</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtensionDescriptions
-&gt; Either HandshakeException ExtensionDescriptions
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-252"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679111971"><span class="annot"><span class="annottext">ext :: ByteString
</span><a href="#local-6989586621679111971"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String ExtensionDescriptions
</span><a href="Network.WebSockets.Extensions.Description.html#parseExtensionDescriptions"><span class="hs-identifier hs-var">Extensions.parseExtensionDescriptions</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679111971"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-253"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679111969"><span class="annot"><span class="annottext">x :: ExtensionDescriptions
</span><a href="#local-6989586621679111969"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtensionDescriptions
-&gt; Either HandshakeException ExtensionDescriptions
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">ExtensionDescriptions
</span><a href="#local-6989586621679111969"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-254"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679111968"><span class="annot"><span class="annottext">err :: String
</span><a href="#local-6989586621679111968"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HandshakeException
-&gt; Either HandshakeException ExtensionDescriptions
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(HandshakeException
 -&gt; Either HandshakeException ExtensionDescriptions)
-&gt; HandshakeException
-&gt; Either HandshakeException ExtensionDescriptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequestHead -&gt; String -&gt; HandshakeException
</span><a href="Network.WebSockets.Http.html#MalformedRequest"><span class="hs-identifier hs-var">MalformedRequest</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHead
</span><a href="#local-6989586621679111972"><span class="hs-identifier hs-var">rq</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; HandshakeException) -&gt; String -&gt; HandshakeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-255"></span><span>                </span><span class="annot"><span class="hs-string">&quot;Malformed Sec-WebSockets-Extensions: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679111968"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-259"></span><span class="annot"><a href="Network.WebSockets.Http.html#decodeHeaderLine"><span class="hs-identifier hs-type">decodeHeaderLine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Parser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CI.CI</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span id="decodeHeaderLine"><span class="annot"><span class="annottext">decodeHeaderLine :: Parser ByteString (CI ByteString, ByteString)
</span><a href="Network.WebSockets.Http.html#decodeHeaderLine"><span class="hs-identifier hs-var hs-var">decodeHeaderLine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="annottext">(CI ByteString -&gt; ByteString -&gt; (CI ByteString, ByteString))
-&gt; Parser ByteString (CI ByteString)
-&gt; Parser ByteString (ByteString -&gt; (CI ByteString, ByteString))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; CI ByteString
forall s. FoldCase s =&gt; s -&gt; CI s
</span><span class="hs-identifier hs-var">CI.mk</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; CI ByteString)
-&gt; Parser ByteString ByteString
-&gt; Parser ByteString (CI ByteString)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Bool) -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeWhile1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><span class="hs-identifier hs-var">c2w</span></span><span> </span><span class="annot"><span class="hs-char">':'</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="annottext">Parser ByteString (ByteString -&gt; (CI ByteString, ByteString))
-&gt; Parser Word8
-&gt; Parser ByteString (ByteString -&gt; (CI ByteString, ByteString))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Word8
</span><span class="hs-identifier hs-var">A.word8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><span class="hs-identifier hs-var">c2w</span></span><span> </span><span class="annot"><span class="hs-char">':'</span></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><span class="annottext">Parser ByteString (ByteString -&gt; (CI ByteString, ByteString))
-&gt; Parser Word8
-&gt; Parser ByteString (ByteString -&gt; (CI ByteString, ByteString))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Word8 -&gt; Parser Word8
forall (f :: * -&gt; *) a. Alternative f =&gt; a -&gt; f a -&gt; f a
</span><span class="hs-identifier hs-var">A.option</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><span class="hs-identifier hs-var">c2w</span></span><span> </span><span class="annot"><span class="hs-char">' '</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Parser Word8
</span><span class="hs-identifier hs-var">A.word8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><span class="hs-identifier hs-var">c2w</span></span><span> </span><span class="annot"><span class="hs-char">' '</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><span class="annottext">Parser ByteString (ByteString -&gt; (CI ByteString, ByteString))
-&gt; Parser ByteString ByteString
-&gt; Parser ByteString (CI ByteString, ByteString)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Bool) -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><span class="hs-identifier hs-var">c2w</span></span><span> </span><span class="annot"><span class="hs-char">'\r'</span></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><span class="annottext">Parser ByteString (CI ByteString, ByteString)
-&gt; Parser ByteString ByteString
-&gt; Parser ByteString (CI ByteString, ByteString)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">A.string</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\r\n&quot;</span></span><span>
</span><span id="line-266"></span></pre></body></html>